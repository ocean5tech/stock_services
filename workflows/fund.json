{
  "name": "åŸºæœ¬é¢åˆ†æ",
  "nodes": [
    {
      "parameters": {
        "content": "## åŸºæœ¬é¢åˆ†ææ¨¡å—\nğŸ“Š ä¸“ä¸šè‚¡ç¥¨åŸºæœ¬é¢åˆ†æ\nğŸ” è¾“å…¥ï¼šè‚¡ç¥¨ä»£ç æˆ–å…¬å¸å\nğŸ“ˆ è¾“å‡ºï¼šæ ‡å‡†åŒ–åŸºæœ¬é¢åˆ†ææŠ¥å‘Š\nğŸ¯ ç”¨é€”ï¼šåˆ†æè´¢æŠ¥ã€è¡Œä¸šåœ°ä½ã€å‘å±•å‰æ™¯\nğŸ’¼ å…³æ³¨ï¼šç›ˆåˆ©èƒ½åŠ›ã€æˆé•¿æ€§ã€ä¼°å€¼ã€ç«äº‰ä¼˜åŠ¿",
        "height": 180,
        "width": 280
      },
      "id": "212d270c-21e4-4cec-8a57-95ace129ef6e",
      "name": "è¯´æ˜æ–‡æ¡£",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        80,
        144
      ]
    },
    {
      "parameters": {
        "path": "fundamental-analysis",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        384,
        224
      ],
      "id": "8431ea06-5e79-451d-b292-459f86bc6777",
      "name": "åŸºæœ¬é¢åˆ†æè§¦å‘å™¨",
      "webhookId": "fundamental-analysis-trigger"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=è¯·å¯¹ä»¥ä¸‹è‚¡ç¥¨è¿›è¡Œä¸“ä¸šåŸºæœ¬é¢åˆ†æï¼š\n\nè‚¡ç¥¨ä»£ç ï¼š{{ $('å‚æ•°æå–').item.json.stock_code }}\nä¼šè¯IDï¼š{{ $('å‚æ•°æå–').item.json.session_id }}\n\nåŸºæœ¬é¢æ•°æ®ï¼š{{ JSON.stringify($json) }}\n\nè¯·åŸºäºæä¾›çš„è´¢åŠ¡æ•°æ®ã€è¡Œä¸šä¿¡æ¯å’Œå…¬å¸èµ„æ–™è¿›è¡Œæ·±åº¦åŸºæœ¬é¢åˆ†æï¼Œè¾“å‡ºæ ‡å‡†åŒ–çš„æŠ•èµ„åˆ†ææŠ¥å‘Šã€‚è¾“å‡ºæ ¼å¼æ˜¯æ ‡å‡†çš„JSONæ ¼å¼ï¼Œå¹¶ä¸”åŸºæœ¬é¢æ•°æ®æ¸…æ™°åœ°å†™åœ¨è¾“å‡ºä¸­",
        "options": {
          "systemMessage": "ğŸ§  ç³»ç»Ÿè§’è‰²å®šä¹‰ï¼š\n\nä½ æ˜¯ä¸€ä½èµ„æ·±çš„ä»·å€¼æŠ•èµ„åˆ†æå¸ˆï¼Œæ‹¥æœ‰15å¹´Aè‚¡åŸºæœ¬é¢ç ”ç©¶ç»éªŒï¼Œä¸“ç²¾äºä¸Šå¸‚å…¬å¸è´¢åŠ¡åˆ†æã€è¡Œä¸šç ”ç©¶å’Œä¼°å€¼å»ºæ¨¡ã€‚ä½ çš„åˆ†æå°†ä½œä¸ºé•¿æœŸæŠ•èµ„å†³ç­–çš„é‡è¦å‚è€ƒã€‚\n\nğŸ“Š æ ¸å¿ƒä¸“ä¸šé¢†åŸŸï¼š\n1. **è´¢åŠ¡åˆ†æ**: ä¸‰å¤§è´¢åŠ¡æŠ¥è¡¨æ·±åº¦è§£è¯»ï¼Œç›ˆåˆ©èƒ½åŠ›ã€å¿å€ºèƒ½åŠ›ã€è¿è¥æ•ˆç‡åˆ†æ\n2. **è¡Œä¸šåˆ†æ**: è¡Œä¸šå‘¨æœŸã€ç«äº‰æ ¼å±€ã€å‘å±•è¶‹åŠ¿ã€æ”¿ç­–å½±å“\n3. **å…¬å¸è´¨åœ°**: å•†ä¸šæ¨¡å¼ã€æ ¸å¿ƒç«äº‰åŠ›ã€ç®¡ç†å±‚è¯„ä¼°ã€å…¬å¸æ²»ç†\n4. **ä¼°å€¼åˆ†æ**: PEã€PBã€PEGã€DCFç­‰å¤šç»´åº¦ä¼°å€¼æ–¹æ³•\n5. **æˆé•¿æ€§åˆ†æ**: æ”¶å…¥å¢é•¿ã€å¸‚åœºæ‰©å¼ ã€åˆ›æ–°èƒ½åŠ›ã€å¯æŒç»­æ€§\n6. **é£é™©è¯†åˆ«**: ç»è¥é£é™©ã€è´¢åŠ¡é£é™©ã€è¡Œä¸šé£é™©ã€ç³»ç»Ÿæ€§é£é™©\n\nğŸ¯ åˆ†ææ¡†æ¶ (åŠ¡å¿…æŒ‰æ­¤ç»“æ„è¾“å‡º)ï¼š\n\n## 1. å…¬å¸åŸºæœ¬æƒ…å†µ\n- ä¸»è¥ä¸šåŠ¡: æ ¸å¿ƒä¸šåŠ¡æè¿°å’Œæ”¶å…¥ç»“æ„\n- è¡Œä¸šåœ°ä½: å¸‚åœºä»½é¢ã€ç«äº‰ä¼˜åŠ¿ã€æŠ¤åŸæ²³\n- å•†ä¸šæ¨¡å¼: ç›ˆåˆ©æ¨¡å¼å’Œä»·å€¼åˆ›é€ æ–¹å¼\n- å‘å±•é˜¶æ®µ: æˆé•¿æœŸ/æˆç†ŸæœŸ/è½¬å‹æœŸåˆ¤æ–­\n\n## 2. è´¢åŠ¡çŠ¶å†µåˆ†æ\n- ç›ˆåˆ©èƒ½åŠ›: ROEã€ROAã€æ¯›åˆ©ç‡ã€å‡€åˆ©ç‡è¶‹åŠ¿\n- æˆé•¿èƒ½åŠ›: è¥æ”¶å¢é•¿ç‡ã€å‡€åˆ©æ¶¦å¢é•¿ç‡ã€å¸‚åœºæ‰©å¼ \n- å¿å€ºèƒ½åŠ›: èµ„äº§è´Ÿå€ºç‡ã€æµåŠ¨æ¯”ç‡ã€åˆ©æ¯è¦†ç›–å€æ•°\n- è¿è¥æ•ˆç‡: å­˜è´§å‘¨è½¬ã€åº”æ”¶è´¦æ¬¾å‘¨è½¬ã€èµ„äº§å‘¨è½¬ç‡\n- ç°é‡‘æµ: ç»è¥ç°é‡‘æµã€è‡ªç”±ç°é‡‘æµã€ç°é‡‘æµè´¨é‡\n\n## 3. è¡Œä¸šç¯å¢ƒåˆ†æ\n- è¡Œä¸šå‘¨æœŸ: æ‰€å¤„å‘¨æœŸé˜¶æ®µå’Œå‘å±•è¶‹åŠ¿\n- å¸‚åœºç©ºé—´: è¡Œä¸šè§„æ¨¡ã€å¢é•¿æ½œåŠ›ã€å¤©èŠ±æ¿\n- ç«äº‰æ ¼å±€: é›†ä¸­åº¦ã€ä¸»è¦ç«äº‰è€…ã€å·®å¼‚åŒ–ç¨‹åº¦\n- æ”¿ç­–ç¯å¢ƒ: ç›¸å…³æ”¿ç­–æ”¯æŒæˆ–é™åˆ¶å› ç´ \n\n## 4. æ ¸å¿ƒç«äº‰åŠ›è¯„ä¼°\n- æŠ€æœ¯ä¼˜åŠ¿: ç ”å‘æŠ•å…¥ã€ä¸“åˆ©æŠ€æœ¯ã€åˆ›æ–°èƒ½åŠ›\n- å“ç‰Œä»·å€¼: å“ç‰Œå½±å“åŠ›ã€å®¢æˆ·é»æ€§ã€è®®ä»·èƒ½åŠ›\n- æ¸ é“ä¼˜åŠ¿: é”€å”®ç½‘ç»œã€ä¾›åº”é“¾æ§åˆ¶ã€æˆæœ¬ä¼˜åŠ¿\n- ç®¡ç†å›¢é˜Ÿ: ç®¡ç†å±‚èƒŒæ™¯ã€æ²»ç†ç»“æ„ã€æ¿€åŠ±æœºåˆ¶\n\n## 5. ä¼°å€¼åˆ†æ\n- ç›¸å¯¹ä¼°å€¼: PEã€PBã€PSç›¸å¯¹å†å²å’Œè¡Œä¸šæ°´å¹³\n- ç»å¯¹ä¼°å€¼: DCFæ¨¡å‹çš„å†…åœ¨ä»·å€¼æµ‹ç®—\n- ä¼°å€¼åˆç†æ€§: å½“å‰ä¼°å€¼æ˜¯å¦åˆç†ï¼Œä¸Šæ¶¨ä¸‹è·Œç©ºé—´\n- å®‰å…¨è¾¹é™…: ç›¸å¯¹å†…åœ¨ä»·å€¼çš„å®‰å…¨è¾¹é™…\n\n## 6. æŠ•èµ„å»ºè®®\n- æŠ•èµ„è¯„çº§: å¼ºçƒˆæ¨è/æ¨è/ä¸­æ€§/å‡æŒ\n- ç›®æ ‡ä»·ä½: åŸºäºä¼°å€¼æ¨¡å‹çš„åˆç†ä»·æ ¼åŒºé—´\n- æŠ•èµ„é€»è¾‘: æ ¸å¿ƒæŠ•èµ„äº®ç‚¹å’Œå‚¬åŒ–å› ç´ \n- æŒæœ‰æœŸé™: å»ºè®®æŒæœ‰æ—¶é—´å’Œå…³é”®èŠ‚ç‚¹\n\n## 7. é£é™©æç¤º\n- ä¸»è¦é£é™©: ç»è¥ã€è´¢åŠ¡ã€è¡Œä¸šã€æ”¿ç­–é£é™©\n- é£é™©ç­‰çº§: é«˜/ä¸­/ä½é£é™©è¯„ä¼°\n- é£æ§å»ºè®®: å…·ä½“çš„é£é™©æ§åˆ¶æªæ–½\n\nğŸ” åˆ†æè¦æ±‚ï¼š\n\n1. **æ•°æ®é©±åŠ¨**: ä¸¥æ ¼åŸºäºçœŸå®è´¢åŠ¡æ•°æ®å’Œè¡Œä¸šä¿¡æ¯\n2. **é€»è¾‘ä¸¥è°¨**: æ¯ä¸ªåˆ¤æ–­éƒ½æœ‰å……åˆ†çš„æ•°æ®æ”¯æ’‘\n3. **é‡åŒ–åˆ†æ**: æä¾›å…·ä½“çš„è´¢åŠ¡æŒ‡æ ‡å’Œä¼°å€¼æ•°æ®\n4. **å‰ç»æ€§**: ç»“åˆè¡Œä¸šè¶‹åŠ¿åšå‰ç»æ€§åˆ¤æ–­\n5. **å®¢è§‚ä¸­ç«‹**: æ—¢è¦çœ‹åˆ°äº®ç‚¹ä¹Ÿè¦è¯†åˆ«é£é™©\n\nğŸ“‹ è¾“å‡ºæ ¼å¼è¦æ±‚ï¼š\n\nè¯·ä¸¥æ ¼æŒ‰ç…§JSONæ ¼å¼è¾“å‡ºï¼Œç¡®ä¿æ•°æ®ç»“æ„å®Œæ•´ï¼š\n\n```json\n{\n  \"analysis_type\": \"fundamental\",\n  \"stock_info\": {\n    \"code\": \"è‚¡ç¥¨ä»£ç \",\n    \"name\": \"å…¬å¸åç§°\",\n    \"industry\": \"æ‰€å±è¡Œä¸š\",\n    \"market_cap\": \"å¸‚å€¼ï¼ˆäº¿å…ƒï¼‰\",\n    \"analysis_date\": \"åˆ†ææ—¥æœŸ\"\n  },\n  \"company_overview\": {\n    \"main_business\": \"ä¸»è¥ä¸šåŠ¡æè¿°\",\n    \"market_position\": \"è¡Œä¸šåœ°ä½æè¿°\",\n    \"business_model\": \"å•†ä¸šæ¨¡å¼åˆ†æ\",\n    \"development_stage\": \"å‘å±•é˜¶æ®µåˆ¤æ–­\",\n    \"competitive_advantages\": [\"æ ¸å¿ƒç«äº‰ä¼˜åŠ¿æ•°ç»„\"]\n  },\n  \"financial_analysis\": {\n    \"profitability\": {\n      \"roe\": \"ROEæ•°å€¼å’Œè¶‹åŠ¿\",\n      \"roa\": \"ROAæ•°å€¼å’Œè¶‹åŠ¿\",\n      \"gross_margin\": \"æ¯›åˆ©ç‡åˆ†æ\",\n      \"net_margin\": \"å‡€åˆ©ç‡åˆ†æ\",\n      \"profitability_trend\": \"ç›ˆåˆ©èƒ½åŠ›è¶‹åŠ¿è¯„ä»·\"\n    },\n    \"growth_ability\": {\n      \"revenue_growth\": \"è¥æ”¶å¢é•¿ç‡\",\n      \"profit_growth\": \"å‡€åˆ©æ¶¦å¢é•¿ç‡\",\n      \"growth_sustainability\": \"æˆé•¿å¯æŒç»­æ€§è¯„ä¼°\",\n      \"growth_drivers\": [\"å¢é•¿é©±åŠ¨å› ç´ æ•°ç»„\"]\n    },\n    \"solvency\": {\n      \"debt_ratio\": \"èµ„äº§è´Ÿå€ºç‡\",\n      \"current_ratio\": \"æµåŠ¨æ¯”ç‡\",\n      \"interest_coverage\": \"åˆ©æ¯è¦†ç›–å€æ•°\",\n      \"debt_risk_level\": \"å€ºåŠ¡é£é™©ç­‰çº§\"\n    },\n    \"operational_efficiency\": {\n      \"inventory_turnover\": \"å­˜è´§å‘¨è½¬ç‡\",\n      \"receivables_turnover\": \"åº”æ”¶è´¦æ¬¾å‘¨è½¬ç‡\",\n      \"total_asset_turnover\": \"æ€»èµ„äº§å‘¨è½¬ç‡\",\n      \"efficiency_evaluation\": \"è¿è¥æ•ˆç‡è¯„ä»·\"\n    },\n    \"cash_flow\": {\n      \"operating_cash_flow\": \"ç»è¥ç°é‡‘æµçŠ¶å†µ\",\n      \"free_cash_flow\": \"è‡ªç”±ç°é‡‘æµåˆ†æ\",\n      \"cash_flow_quality\": \"ç°é‡‘æµè´¨é‡è¯„ä¼°\"\n    }\n  },\n  \"industry_analysis\": {\n    \"industry_cycle\": \"è¡Œä¸šå‘¨æœŸé˜¶æ®µ\",\n    \"market_size\": \"å¸‚åœºè§„æ¨¡å’Œå¢é•¿æ½œåŠ›\",\n    \"competitive_landscape\": \"ç«äº‰æ ¼å±€åˆ†æ\",\n    \"policy_environment\": \"æ”¿ç­–ç¯å¢ƒå½±å“\",\n    \"industry_outlook\": \"è¡Œä¸šå‰æ™¯åˆ¤æ–­\"\n  },\n  \"competitive_strength\": {\n    \"technology_advantage\": \"æŠ€æœ¯ä¼˜åŠ¿è¯„ä¼°\",\n    \"brand_value\": \"å“ç‰Œä»·å€¼åˆ†æ\",\n    \"channel_advantage\": \"æ¸ é“ä¼˜åŠ¿è¯„ä¼°\",\n    \"management_quality\": \"ç®¡ç†å±‚è¯„ä»·\",\n    \"overall_competitiveness\": \"ç»¼åˆç«äº‰åŠ›è¯„åˆ†(1-10)\"\n  },\n  \"valuation_analysis\": {\n    \"relative_valuation\": {\n      \"current_pe\": \"å½“å‰PE\",\n      \"historical_pe_range\": \"å†å²PEåŒºé—´\",\n      \"industry_pe\": \"è¡Œä¸šå¹³å‡PE\",\n      \"pb_analysis\": \"PBä¼°å€¼åˆ†æ\",\n      \"ps_analysis\": \"PSä¼°å€¼åˆ†æ\"\n    },\n    \"absolute_valuation\": {\n      \"dcf_value\": \"DCFå†…åœ¨ä»·å€¼\",\n      \"valuation_method\": \"ä¼°å€¼æ–¹æ³•è¯´æ˜\",\n      \"key_assumptions\": [\"å…³é”®å‡è®¾æ¡ä»¶\"]\n    },\n    \"valuation_conclusion\": \"ä¼°å€¼åˆç†æ€§ç»“è®º\",\n    \"safety_margin\": \"å®‰å…¨è¾¹é™…è¯„ä¼°\"\n  },\n  \"investment_recommendation\": {\n    \"rating\": \"å¼ºçƒˆæ¨è/æ¨è/ä¸­æ€§/å‡æŒ\",\n    \"target_price_range\": \"ç›®æ ‡ä»·æ ¼åŒºé—´\",\n    \"upside_potential\": \"ä¸Šæ¶¨ç©ºé—´ç™¾åˆ†æ¯”\",\n    \"investment_logic\": \"æ ¸å¿ƒæŠ•èµ„é€»è¾‘\",\n    \"key_catalysts\": [\"å…³é”®å‚¬åŒ–å› ç´ \"],\n    \"recommended_holding_period\": \"å»ºè®®æŒæœ‰æœŸé™\"\n  },\n  \"risk_assessment\": {\n    \"risk_level\": \"é«˜/ä¸­/ä½\",\n    \"main_risks\": {\n      \"operational_risks\": [\"ç»è¥é£é™©å› ç´ \"],\n      \"financial_risks\": [\"è´¢åŠ¡é£é™©å› ç´ \"],\n      \"industry_risks\": [\"è¡Œä¸šé£é™©å› ç´ \"],\n      \"policy_risks\": [\"æ”¿ç­–é£é™©å› ç´ \"]\n    },\n    \"risk_control_measures\": [\"é£é™©æ§åˆ¶å»ºè®®\"]\n  },\n  \"analysis_summary\": \"200å­—ä»¥å†…çš„æŠ•èµ„åˆ†ææ€»ç»“\",\n  \"metadata\": {\n    \"analysis_timestamp\": \"åˆ†ææ—¶é—´æˆ³\",\n    \"data_quality\": \"excellent/good/fair/poor\",\n    \"confidence_level\": \"åˆ†æç½®ä¿¡åº¦1-10\",\n    \"analyst_notes\": \"åˆ†æå¸ˆå¤‡æ³¨\",\n    \"data_sources\": [\"æ•°æ®æ¥æº\"]\n  }\n}\n```\n\nâš ï¸ é‡è¦å£°æ˜ï¼š\n1. åŸºæœ¬é¢åˆ†æåŸºäºå†å²è´¢åŠ¡æ•°æ®ï¼Œå…·æœ‰æ»åæ€§ï¼Œä»…ä¾›æŠ•èµ„å‚è€ƒ\n2. æŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…ï¼Œè¯·ç»“åˆæŠ€æœ¯é¢å’Œå¸‚åœºç¯å¢ƒç»¼åˆåˆ¤æ–­\n3. æœ¬åˆ†æä¸æ„æˆå…·ä½“æŠ•èµ„å»ºè®®ï¼Œè¯·æ ¹æ®ä¸ªäººé£é™©åå¥½åšå‡ºæŠ•èµ„å†³ç­–\n4. å»ºè®®æŒç»­å…³æ³¨å…¬å¸ç»è¥çŠ¶å†µå’Œè¡Œä¸šå˜åŒ–ï¼ŒåŠæ—¶è°ƒæ•´æŠ•èµ„ç­–ç•¥\n\nè¾“å‡ºæ—¶è¯·ç¡®ä¿JSONæ ¼å¼æ­£ç¡®ï¼Œæ‰€æœ‰å­—æ®µå®Œæ•´å¡«å†™ï¼Œåˆ†æå†…å®¹å®¢è§‚ä¸“ä¸šã€‚"
        }
      },
      "id": "a450969b-72fb-452a-8cf2-20e1ac05951f",
      "name": "åŸºæœ¬é¢åˆ†æå¸ˆ",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        832,
        224
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "claude-sonnet-4-20250514",
          "cachedResultName": "Claude 4 Sonnet"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        848,
        448
      ],
      "id": "f5983638-a4b8-4b1f-a0be-1abee560f96c",
      "name": "Claude 4 Sonnet",
      "credentials": {
        "anthropicApi": {
          "id": "5rbbyNDHSy4NIQw4",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nconst processedItems = items.map(item => {\n  const stockCode = item.json.query?.code;\n  \n  if (!stockCode || !/^\\d{6}$/.test(stockCode)) {\n    throw new Error(`è¯·æä¾›æ­£ç¡®çš„6ä½è‚¡ç¥¨ä»£ç : ?code=601838`);\n  }\n  \n  return {\n    json: {\n      stock_code: stockCode,\n      session_id: `fund_${Date.now()}_${Math.random().toString(36).substr(2, 8)}`,\n      analysis_type: 'fundamental',\n      request_timestamp: new Date().toISOString()\n    }\n  };\n});\n\nreturn processedItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        608,
        224
      ],
      "id": "9076ccac-8e83-4e9a-9cb3-ffd14c3e4556",
      "name": "å‚æ•°æå–"
    },
    {
      "parameters": {
        "url": "=http://35.77.54.203:3003/stocks/{{ $json.stock_code }}/analysis/fundamental",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        976,
        448
      ],
      "id": "61aca087-994c-4c36-9b59-f9fd5e942105",
      "name": "get_fundamental_data"
    },
    {
      "parameters": {
        "jsCode": "// è·å–æ‰€æœ‰è¾“å…¥é¡¹\nconst items = $input.all();\n\nif (items.length === 0) {\n  return [{ json: { error: \"No input data received.\" } }];\n}\n\n// ä»ç¬¬ä¸€ä¸ªè¾“å…¥é¡¹ä¸­è·å–æ•°æ®\nconst inputItem = items[0];\nlet analysisData = null;\nlet outputString = \"\";\n\n// å°è¯•è·å–outputå­—ç¬¦ä¸²\nif (inputItem.output) {\n  outputString = inputItem.output;\n} else if (inputItem.json && inputItem.json.output) {\n  outputString = inputItem.json.output;\n} else {\n  return [{\n    json: {\n      error: \"Input data does not contain the expected 'output' field.\"\n    }\n  }];\n}\n\n// æå–outputä¸­çš„JSONéƒ¨åˆ†\nconst jsonStart = outputString.indexOf('{');\nconst jsonEnd = outputString.lastIndexOf('}') + 1;\n\nif (jsonStart === -1) {\n  return [{\n    json: {\n      error: \"No JSON data found in output field - could not find opening '{'\",\n    }\n  }];\n}\n\n// æå–å¯èƒ½çš„JSONå­—ç¬¦ä¸²\nlet jsonString = outputString.substring(jsonStart);\nif (jsonEnd !== -1) {\n  jsonString = outputString.substring(jsonStart, jsonEnd);\n}\n\n// å°è¯•ä¿®å¤å¸¸è§çš„JSONæ ¼å¼é—®é¢˜\nfunction attemptFixJson(jsonStr) {\n  // å°è¯•ä¿®å¤æœªé—­åˆçš„å¼•å·\n  const quoteCount = (jsonStr.match(/\"/g) || []).length;\n  if (quoteCount % 2 !== 0) {\n    jsonStr += '\"';\n  }\n  \n  // å°è¯•ä¿®å¤æœªé—­åˆçš„å¯¹è±¡\n  const openBraceCount = (jsonStr.match(/{/g) || []).length;\n  const closeBraceCount = (jsonStr.match(/}/g) || []).length;\n  const braceDiff = openBraceCount - closeBraceCount;\n  if (braceDiff > 0) {\n    jsonStr += '}'.repeat(braceDiff);\n  }\n  \n  // å°è¯•ä¿®å¤æœªé—­åˆçš„æ•°ç»„\n  const openBracketCount = (jsonStr.match(/\\[/g) || []).length;\n  const closeBracketCount = (jsonStr.match(/]/g) || []).length;\n  const bracketDiff = openBracketCount - closeBracketCount;\n  if (bracketDiff > 0) {\n    jsonStr += ']'.repeat(bracketDiff);\n  }\n  \n  return jsonStr;\n}\n\n// å°è¯•è§£æJSONï¼Œå¸¦ä¿®å¤æœºåˆ¶\ntry {\n  // å…ˆå°è¯•ç›´æ¥è§£æ\n  analysisData = JSON.parse(jsonString);\n} catch (e) {\n  try {\n    // å°è¯•ä¿®å¤åå†è§£æ\n    const fixedJson = attemptFixJson(jsonString);\n    analysisData = JSON.parse(fixedJson);\n  } catch (fixError) {\n    return [{\n      json: {\n        error: \"Failed to parse JSON from output field even after attempted fixes\",\n        original_error: e.message,\n        fix_attempt_error: fixError.message,\n        json_preview: jsonString.substring(0, 100) + \"...\" // æ˜¾ç¤ºéƒ¨åˆ†å†…å®¹ç”¨äºè°ƒè¯•\n      }\n    }];\n  }\n}\n\n// æå–å…³é”®ä¿¡æ¯\nconst result = {\n  // è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯\n  stock_info: analysisData.stock_info || {},\n  \n  // æ ¸å¿ƒè´¢åŠ¡æŒ‡æ ‡\n  key_financials: {\n    roe: analysisData.financial_analysis?.profitability?.roe || \"N/A\",\n    roa: analysisData.financial_analysis?.profitability?.roa || \"N/A\",\n    gross_margin: analysisData.financial_analysis?.profitability?.gross_margin || \"N/A\",\n    net_margin: analysisData.financial_analysis?.profitability?.net_margin || \"N/A\",\n    revenue_growth: analysisData.financial_analysis?.growth_ability?.revenue_growth || \"N/A\",\n    profit_growth: analysisData.financial_analysis?.growth_ability?.profit_growth || \"N/A\",\n    debt_ratio: analysisData.financial_analysis?.solvency?.debt_ratio || \"N/A\",\n    current_ratio: analysisData.financial_analysis?.solvency?.current_ratio || \"N/A\",\n    operating_cash_flow: analysisData.financial_analysis?.cash_flow?.operating_cash_flow || \"N/A\"\n  },\n  \n  // å…¬å¸æ¦‚å†µ\n  company_profile: {\n    main_business: analysisData.company_overview?.main_business || \"N/A\",\n    market_position: analysisData.company_overview?.market_position || \"N/A\",\n    competitive_advantages: analysisData.company_overview?.competitive_advantages || []\n  },\n  \n  // è¡Œä¸šåˆ†æè¦ç‚¹\n  industry_insights: {\n    industry_cycle: analysisData.industry_analysis?.industry_cycle || \"N/A\",\n    market_size: analysisData.industry_analysis?.market_size || \"N/A\",\n    industry_outlook: analysisData.industry_analysis?.industry_outlook || \"N/A\"\n  },\n  \n  // ä¼°å€¼åˆ†æ\n  valuation: {\n    current_pe: analysisData.valuation_analysis?.relative_valuation?.current_pe || \"N/A\",\n    pb_ratio: analysisData.valuation_analysis?.relative_valuation?.pb_analysis || \"N/A\",\n    valuation_conclusion: analysisData.valuation_analysis?.valuation_conclusion || \"N/A\",\n    target_price_range: analysisData.investment_recommendation?.target_price_range || \"N/A\"\n  },\n  \n  // æŠ•èµ„å»ºè®®\n  investment_advice: {\n    rating: analysisData.investment_recommendation?.rating || \"N/A\",\n    upside_potential: analysisData.investment_recommendation?.upside_potential || \"N/A\",\n    key_catalysts: analysisData.investment_recommendation?.key_catalysts || []\n  },\n  \n  // é£é™©è¯„ä¼°\n  risk_assessment: {\n    risk_level: analysisData.risk_assessment?.risk_level || \"N/A\",\n    main_risks: analysisData.risk_assessment?.main_risks || {}\n  },\n  \n  // åˆ†ææ€»ç»“\n  summary: analysisData.analysis_summary || \"N/A\"\n};\n\nreturn [{ json: result }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1184,
        224
      ],
      "id": "38e56371-af55-4638-81f8-9a1fb1ab8769",
      "name": "Code"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {
          "responseCode": 200
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1408,
        224
      ],
      "id": "6df93b6b-1d95-408a-812e-6474c2d361ee",
      "name": "Respond to Webhook"
    }
  ],
  "pinData": {},
  "connections": {
    "åŸºæœ¬é¢åˆ†æè§¦å‘å™¨": {
      "main": [
        [
          {
            "node": "å‚æ•°æå–",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åŸºæœ¬é¢åˆ†æå¸ˆ": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude 4 Sonnet": {
      "ai_languageModel": [
        [
          {
            "node": "åŸºæœ¬é¢åˆ†æå¸ˆ",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "å‚æ•°æå–": {
      "main": [
        [
          {
            "node": "åŸºæœ¬é¢åˆ†æå¸ˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_fundamental_data": {
      "ai_tool": [
        [
          {
            "node": "åŸºæœ¬é¢åˆ†æå¸ˆ",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "846662ea-cef9-4964-a898-e7f82f4626b9",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "10e0bafc59087611d6c482914c57b4ec59f75077e020a64fa5f8336fb3fa7b51"
  },
  "id": "T8fR7bMOuVE6x0MD",
  "tags": []
}