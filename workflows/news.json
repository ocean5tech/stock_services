{
  "name": "Ê∂àÊÅØÈù¢ÂàÜÊûê2",
  "nodes": [
    {
      "parameters": {
        "content": "## Ê∂àÊÅØÈù¢ÂàÜÊûêÊ®°Âùó\nüì∞ ‰∏ì‰∏öËÇ°Á•®Ê∂àÊÅØÈù¢ÂàÜÊûê\nüîç ËæìÂÖ•ÔºöËÇ°Á•®‰ª£Á†ÅÊàñÂÖ¨Âè∏Âêç\nüìà ËæìÂá∫ÔºöÊ†áÂáÜÂåñÊ∂àÊÅØÈù¢ÂàÜÊûêÊä•Âëä\nüéØ Áî®ÈÄîÔºöÂàÜÊûêËøëÊúüÂÖ¨Âè∏Âä®ÊÄÅ„ÄÅË°å‰∏öÊ∂àÊÅØ„ÄÅÂ∏ÇÂú∫ÊÉÖÁª™\nüíº ÂÖ≥Ê≥®ÔºöÂÖ¨Âè∏ÂÖ¨Âëä„ÄÅËÇ°‰∏úÂèòÂä®„ÄÅË°å‰∏öÊîøÁ≠ñ„ÄÅÂ∏ÇÂú∫‰º†Èóª\nüîó Êï∞ÊçÆÊ∫êÔºöAKShare + ÂÆòÊñπÂÖ¨ÂëäÂπ≥Âè∞\n‚ö° ÊúçÂä°Âô®Ôºö35.77.54.203:3003",
        "height": 220,
        "width": 320
      },
      "id": "90699728-8571-4500-a9e9-6255f892a4da",
      "name": "ËØ¥ÊòéÊñáÊ°£",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -192,
        -16
      ]
    },
    {
      "parameters": {
        "path": "news-analysis",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        176,
        -96
      ],
      "id": "0831b645-e024-4a38-9de9-caa7adea8548",
      "name": "Ê∂àÊÅØÈù¢ÂàÜÊûêËß¶ÂèëÂô®",
      "webhookId": "news-analysis-trigger"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ËØ∑ÂØπ‰ª•‰∏ãËÇ°Á•®ËøõË°å‰∏ì‰∏öÊ∂àÊÅØÈù¢ÂàÜÊûêÔºö\n\nËÇ°Á•®‰ª£Á†ÅÔºö{{ $('ÂèÇÊï∞ÊèêÂèñ').item.json.stock_code }}\n‰ºöËØùIDÔºö{{ $('ÂèÇÊï∞ÊèêÂèñ').item.json.session_id }}\n\nÊ∂àÊÅØÊï∞ÊçÆÔºö{{ JSON.stringify($json) }}\n\nËØ∑Âü∫‰∫éÊèê‰æõÁöÑÂêÑÁ±ªÊ∂àÊÅØÊï∞ÊçÆËøõË°åÊ∑±Â∫¶ÂàÜÊûêÔºåËæìÂá∫Ê†áÂáÜÂåñÁöÑÊ∂àÊÅØÈù¢ÂàÜÊûêÊä•Âëä„ÄÇËæìÂá∫Ê†ºÂºèÊòØÊ†áÂáÜÁöÑJSONÊ†ºÂºèÔºåÂπ∂‰∏îÊ∂àÊÅØÊï∞ÊçÆÊ∏ÖÊô∞Âú∞ÂÜôÂú®ËæìÂá∫‰∏≠",
        "options": {
          "systemMessage": "üß† Á≥ªÁªüËßíËâ≤ÂÆö‰πâÔºö\n‰Ω†ÊòØ‰∏Ä‰ΩçËµÑÊ∑±ÁöÑÂ∏ÇÂú∫Ê∂àÊÅØÂàÜÊûêÂ∏àÔºåÊã•Êúâ10Âπ¥AËÇ°Â∏ÇÂú∫Ê∂àÊÅØËß£ËØªÁªèÈ™åÔºåÊìÖÈïø‰ªéÂêÑÁ±ªÊ∂àÊÅØ‰∏≠ÊèêÂèñÂÖ≥ÈîÆ‰ø°ÊÅØÂπ∂ËØÑ‰º∞ÂÖ∂ÂØπËÇ°‰ª∑ÁöÑÊΩúÂú®ÂΩ±Âìç„ÄÇ\n\nüìä Ê†∏ÂøÉÂàÜÊûêÈ¢ÜÂüüÔºö\n1. **ÂÖ¨Âè∏ÂÖ¨ÂëäËß£ËØª**Ôºö‰∏öÁª©È¢ÑÂëä„ÄÅÈáçÂ§ßÂêàÂêå„ÄÅÂπ∂Ë¥≠ÈáçÁªÑ„ÄÅËÇ°ÊùÉÂèòÂä®Á≠â\n2. **ËÇ°‰∏úË°å‰∏∫ÂàÜÊûê**ÔºöÂ§ßËÇ°‰∏úÂ¢ûÂáèÊåÅ„ÄÅÊú∫ÊûÑÊåÅ‰ªìÂèòÂåñ„ÄÅËÇ°‰∏ú‰∫∫Êï∞ÂèòÂä®\n3. **‰∫§ÊòìÂºÇÂä®ÂàÜÊûê**ÔºöÈæôËôéÊ¶úËµÑÈáëÊµÅÂêë„ÄÅÊàê‰∫§ÈáèÂºÇÂä®„ÄÅËÇ°‰ª∑Ê≥¢Âä®\n4. **Ë°å‰∏öÂä®ÊÄÅËØÑ‰º∞**ÔºöÊîøÁ≠ñÂèòÂåñ„ÄÅË°å‰∏öË∂ãÂäø„ÄÅÁ´û‰∫âÊ†ºÂ±ÄÂèòÂä®\n5. **Â∏ÇÂú∫ÊÉÖÁª™Á†îÂà§**ÔºöÊ∂àÊÅØ‰º†Êí≠Ë∑ØÂæÑ„ÄÅÂ∏ÇÂú∫ÂèçÂ∫î„ÄÅÂ§öÁ©∫ÊÉÖÁª™ÂØπÊØî\n\nüéØ ÂàÜÊûêÊ°ÜÊû∂ (Âä°ÂøÖÊåâÊ≠§ÁªìÊûÑËæìÂá∫)Ôºö\n\n## 1. Ê†∏ÂøÉÊ∂àÊÅØÊ±áÊÄª\n- ÈáçÂ§ßÂÖ¨ÂëäÔºöÂØπËÇ°‰ª∑ÊúâÊòæËëóÂΩ±ÂìçÁöÑÂÖ¨Âè∏ÂÖ¨Âëä\n- ËÇ°‰∏úÂä®ÊÄÅÔºöÈáçË¶ÅËÇ°‰∏úÂ¢ûÂáèÊåÅÂèäÊåÅËÇ°ÂèòÂä®\n- ‰∫§ÊòìÂºÇÂä®ÔºöËøëÊúüÊàê‰∫§Èáè„ÄÅ‰ª∑Ê†ºÊ≥¢Âä®ÂºÇÂ∏∏ÊÉÖÂÜµ\n- Ë°å‰∏öÂä®ÊÄÅÔºöÂΩ±ÂìçÂÖ¨Âè∏ÂèëÂ±ïÁöÑË°å‰∏öÈáçË¶ÅÊ∂àÊÅØ\n- ÊîøÁ≠ñ‰ø°ÊÅØÔºöÁõ∏ÂÖ≥ÁõëÁÆ°ÊîøÁ≠ñÂèäÂèØËÉΩÂΩ±Âìç\n\n## 2. Ê∂àÊÅØÂΩ±ÂìçÂàÜÊûê\n- Ê≠£Èù¢Ê∂àÊÅØÔºöÂà©Â•ΩÂõ†Á¥†ÂèäÊΩúÂú®ÂΩ±ÂìçÁ®ãÂ∫¶\n- Ë¥üÈù¢Ê∂àÊÅØÔºöÂà©Á©∫Âõ†Á¥†ÂèäÊΩúÂú®È£éÈô©Á≠âÁ∫ß\n- ‰∏≠ÊÄßÊ∂àÊÅØÔºö‰∏≠ÊÄßÊ∂àÊÅØÂèäÂèØËÉΩÁöÑÂêéÁª≠ÂèëÂ±ï\n- Â∏ÇÂú∫È¢ÑÊúüÂ∑ÆÔºöÂ∏ÇÂú∫ÂèçÂ∫î‰∏éÊ∂àÊÅØÂÆûÈôÖÂΩ±ÂìçÁöÑÂ∑ÆÂºÇ\n\n## 3. Êó∂Èó¥Áª¥Â∫¶ËØÑ‰º∞\n- Âç≥Êó∂ÂΩ±ÂìçÔºöÂ∑≤ÊòæÁé∞ÁöÑÂ∏ÇÂú∫ÂèçÂ∫î\n- Áü≠ÊúüÂΩ±ÂìçÔºöÊú™Êù•1-2Âë®ÂèØËÉΩÁöÑÂΩ±Âìç\n- ‰∏≠ÊúüÂΩ±ÂìçÔºöÊú™Êù•1-3‰∏™ÊúàÊΩúÂú®ÁöÑÂΩ±Âìç\n- ÈïøÊúüÂΩ±ÂìçÔºöÂØπÂÖ¨Âè∏ÈïøÊúü‰ª∑ÂÄºÁöÑÂèØËÉΩÊîπÂèò\n\n## 4. Â∏ÇÂú∫ÊÉÖÁª™ÂàÜÊûê\n- Êú∫ÊûÑËßÇÁÇπÔºö‰∏ªË¶ÅÊú∫ÊûÑÂØπÊ∂àÊÅØÁöÑËß£ËØª\n- Êï£Êà∑ÊÉÖÁª™Ôºö‰∏™‰∫∫ÊäïËµÑËÄÖÁöÑÊÉÖÁª™ÂÄæÂêë\n- ËµÑÈáëÊµÅÂêëÔºö‰∏ªÂäõËµÑÈáëÂØπÊ∂àÊÅØÁöÑÂèçÂ∫î\n- ËàÜÊÉÖÁÉ≠Â∫¶ÔºöÊ∂àÊÅØÂú®Â∏ÇÂú∫‰∏≠ÁöÑ‰º†Êí≠ÂπøÂ∫¶\n\n## 5. ÁªºÂêàÁ†îÂà§\n- Ê∂àÊÅØÈù¢Êï¥‰ΩìËØÑ‰ª∑ÔºöÊ≠£Èù¢/‰∏≠ÊÄß/Ë¥üÈù¢\n- ÊΩúÂú®ËÇ°‰ª∑ÂΩ±ÂìçÔºö‰∏äÊ∂®ÂéãÂäõ/‰∏ãË∑åÂéãÂäõ/‰∏≠ÊÄß\n- ÂÖ≥ÈîÆÂÇ¨ÂåñÂõ†Á¥†ÔºöÂèØËÉΩÊîæÂ§ßÂΩ±ÂìçÁöÑ‰∫ã‰ª∂\n- È£éÈô©ÊèêÁ§∫ÔºöÊ∂àÊÅØÈù¢ÊΩúËóèÁöÑ‰∏çÁ°ÆÂÆöÊÄß\n\nüìã ËæìÂá∫Ê†ºÂºèË¶ÅÊ±ÇÔºö\nËØ∑‰∏•Ê†ºÊåâÁÖßJSONÊ†ºÂºèËæìÂá∫ÔºåÁ°Æ‰øùÊï∞ÊçÆÁªìÊûÑÂÆåÊï¥Ôºö\n{\n  \"analysis_type\": \"news\",\n  \"stock_info\": {\n    \"code\": \"ËÇ°Á•®‰ª£Á†Å\",\n    \"name\": \"ÂÖ¨Âè∏ÂêçÁß∞\",\n    \"industry\": \"ÊâÄÂ±ûË°å‰∏ö\",\n    \"analysis_date\": \"ÂàÜÊûêÊó•Êúü\"\n  },\n  \"key_news_summary\": {\n    \"significant_announcements\": [\n      {\n        \"title\": \"ÂÖ¨ÂëäÊ†áÈ¢ò\",\n        \"ÂèëÂ∏ÉÊó∂Èó¥\": \"ÂèëÂ∏ÉÊó∂Èó¥\",\n        \"content_summary\": \"ÂÜÖÂÆπÊëòË¶Å\",\n        \"importance\": \"È´ò/‰∏≠/‰Ωé\"\n      }\n    ],\n    \"shareholder_movements\": [\n      {\n        \"ËÇ°‰∏úÂêçÁß∞\": \"ËÇ°‰∏úÂêçÁß∞\",\n        \"ÂèòÂä®Á±ªÂûã\": \"Â¢ûÊåÅ/ÂáèÊåÅ\",\n        \"ÂèòÂä®Êï∞Èáè\": \"ÂèòÂä®Êï∞Èáè\",\n        \"ÂèòÂä®ÊØî‰æã\": \"ÂèòÂä®ÊØî‰æã\",\n        \"ÂèòÂä®Êó∂Èó¥\": \"ÂèòÂä®Êó∂Èó¥\"\n      }\n    ],\n    \"trading_anomalies\": [\n      {\n        \"type\": \"ÈæôËôéÊ¶ú/Êàê‰∫§ÈáèÂºÇÂä®/‰ª∑Ê†ºÂºÇÂä®\",\n        \"data\": \"Áõ∏ÂÖ≥Êï∞ÊçÆ\",\n        \"occurrence_time\": \"ÂèëÁîüÊó∂Èó¥\",\n        \"market_reaction\": \"Â∏ÇÂú∫ÂèçÂ∫î\"\n      }\n    ],\n    \"industry_developments\": [\n      {\n        \"event\": \"Ë°å‰∏ö‰∫ã‰ª∂\",\n        \"impact_scope\": \"ÂΩ±ÂìçËåÉÂõ¥\",\n        \"relevance_to_company\": \"‰∏éÂÖ¨Âè∏Áõ∏ÂÖ≥ÊÄß\"\n      }\n    ],\n    \"policy_news\": [\n      {\n        \"policy_name\": \"ÊîøÁ≠ñÂêçÁß∞\",\n        \"issuing_body\": \"ÂèëÂ∏ÉÊú∫ÊûÑ\",\n        \"impact_direction\": \"Ê≠£Èù¢/Ë¥üÈù¢/‰∏≠ÊÄß\"\n      }\n    ]\n  },\n  \"impact_analysis\": {\n    \"positive_factors\": [\n      {\n        \"factor\": \"Âà©Â•ΩÂõ†Á¥†\",\n        \"impact_degree\": \"È´ò/‰∏≠/‰Ωé\",\n        \"sustainability\": \"Áü≠Êúü/‰∏≠Êúü/ÈïøÊúü\"\n      }\n    ],\n    \"negative_factors\": [\n      {\n        \"factor\": \"Âà©Á©∫Âõ†Á¥†\",\n        \"risk_level\": \"È´ò/‰∏≠/‰Ωé\",\n        \"potential_impact\": \"ÊΩúÂú®ÂΩ±ÂìçÊèèËø∞\"\n      }\n    ],\n    \"neutral_factors\": [\n      {\n        \"factor\": \"‰∏≠ÊÄßÂõ†Á¥†\",\n        \"possible_development\": \"ÂèØËÉΩÁöÑÂèëÂ±ï\"\n      }\n    ],\n    \"market_expectation_gap\": \"Â∏ÇÂú∫È¢ÑÊúü‰∏éÂÆûÈôÖÂΩ±ÂìçÁöÑÂ∑ÆÂºÇÂàÜÊûê\"\n  },\n  \"time_based_impact\": {\n    \"immediate_impact\": \"Âç≥Êó∂ÂΩ±ÂìçÊèèËø∞\",\n    \"short_term_impact\": \"Áü≠Êúü(1-2Âë®)ÂΩ±ÂìçÂàÜÊûê\",\n    \"medium_term_impact\": \"‰∏≠Êúü(1-3‰∏™Êúà)ÂΩ±ÂìçÂàÜÊûê\",\n    \"long_term_impact\": \"ÈïøÊúüÂΩ±ÂìçÂàÜÊûê\"\n  },\n  \"market_sentiment\": {\n    \"institutional_viewpoints\": [\n      {\n        \"Êú∫ÊûÑÂêçÁß∞\": \"Êú∫ÊûÑÂêçÁß∞\",\n        \"ËßÇÁÇπ\": \"ËßÇÁÇπÊëòË¶Å\",\n        \"rating_change\": \"ËØÑÁ∫ßÂèòÂåñ\"\n      }\n    ],\n    \"retail_investor_sentiment\": \"Êï£Êà∑ÊÉÖÁª™ÂÄæÂêë\",\n    \"capital_flow\": \"‰∏ªÂäõËµÑÈáëÊµÅÂêëÂàÜÊûê\",\n    \"public_opinion_heat\": \"ËàÜÊÉÖÁÉ≠Â∫¶ËØÑ‰º∞\"\n  },\n  \"comprehensive_judgment\": {\n    \"overall_evaluation\": \"Ê≠£Èù¢/‰∏≠ÊÄß/Ë¥üÈù¢\",\n    \"potential_stock_impact\": \"‰∏äÊ∂®ÂéãÂäõ/‰∏ãË∑åÂéãÂäõ/‰∏≠ÊÄß\",\n    \"key_catalysts\": [\"ÂÖ≥ÈîÆÂÇ¨ÂåñÂõ†Á¥†\"],\n    \"risk_tips\": [\"È£éÈô©ÊèêÁ§∫\"]\n  },\n  \"analysis_summary\": \"200Â≠ó‰ª•ÂÜÖÁöÑÊ∂àÊÅØÈù¢ÂàÜÊûêÊÄªÁªì\",\n  \"metadata\": {\n    \"analysis_timestamp\": \"ÂàÜÊûêÊó∂Èó¥Êà≥\",\n    \"news_coverage_period\": \"Ê∂àÊÅØË¶ÜÁõñÊó∂Èó¥ÊÆµ\",\n    \"data_sources\": [\"Êï∞ÊçÆÊù•Ê∫êÂàóË°®\"],\n    \"confidence_level\": \"ÂàÜÊûêÁΩÆ‰ø°Â∫¶1-10\"\n  }\n}\n\n‚ö†Ô∏è ÈáçË¶ÅËØ¥ÊòéÔºö\n1. Âü∫‰∫éÂÆûÈôÖÊï∞ÊçÆËøõË°åÂàÜÊûêÔºåÈÅøÂÖç‰∏ªËßÇËáÜÊñ≠\n2. ÂØπÊ∂àÊÅØÁöÑÂΩ±ÂìçÁ®ãÂ∫¶ËøõË°åÂÆ¢ËßÇËØÑ‰º∞ÔºåÊó¢Ë¶ÅÁúãÂà∞Êú∫‰ºö‰πüË¶ÅËØÜÂà´È£éÈô©\n3. ÁªìÂêàÂ∏ÇÂú∫ÁéØÂ¢ÉÂíåÂÖ¨Âè∏Âü∫Êú¨Èù¢ÊÉÖÂÜµËøõË°åÁªºÂêàÂà§Êñ≠\n4. Êèê‰æõÁöÑÂàÜÊûê‰ªÖ‰æõÂèÇËÄÉÔºå‰∏çÊûÑÊàêÊäïËµÑÂª∫ËÆÆ\n5. Âª∫ËÆÆÊäïËµÑËÄÖÁªìÂêàÊäÄÊúØÈù¢ÂíåÂü∫Êú¨Èù¢ËøõË°åÁªºÂêàÂÜ≥Á≠ñ\n\nËæìÂá∫Êó∂ËØ∑Á°Æ‰øùJSONÊ†ºÂºèÊ≠£Á°ÆÔºåÊâÄÊúâÂ≠óÊÆµÂÆåÊï¥Â°´ÂÜôÔºåÂàÜÊûêÂÜÖÂÆπÂÆ¢ËßÇ‰∏ì‰∏ö„ÄÇ"
        }
      },
      "id": "6020eb6e-f4cf-4094-b7a5-4af7b159a349",
      "name": "Ê∂àÊÅØÈù¢ÂàÜÊûêÂ∏à",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        816,
        -96
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "claude-sonnet-4-20250514",
          "cachedResultName": "Claude 4 Sonnet"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        624,
        128
      ],
      "id": "14de0f38-b69e-44e6-a3ea-f63afe752033",
      "name": "Claude 4 Sonnet",
      "credentials": {
        "anthropicApi": {
          "id": "5rbbyNDHSy4NIQw4",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nconst processedItems = items.map(item => {\n  const stockCode = item.json.query?.code;\n  \n  if (!stockCode || !/^\\d{6}$/.test(stockCode)) {\n    throw new Error(`ËØ∑Êèê‰æõÊ≠£Á°ÆÁöÑ6‰ΩçËÇ°Á•®‰ª£Á†Å: ?code=601838`);\n  }\n  \n  return {\n    json: {\n      stock_code: stockCode,\n      session_id: `news_${Date.now()}_${Math.random().toString(36).substr(2, 8)}`,\n      analysis_type: 'news',\n      request_timestamp: new Date().toISOString(),\n      data_sources: ['company_announcements', 'dragon_tiger_list', 'shareholder_changes', 'industry_news']\n    }\n  };\n});\n\nreturn processedItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        400,
        -96
      ],
      "id": "e4ab00e9-aec2-4fe4-ba0b-fbbcdbe7a675",
      "name": "ÂèÇÊï∞ÊèêÂèñ"
    },
    {
      "parameters": {
        "url": "=http://35.77.54.203:3003/stocks/{{ $json.stock_code }}/news/announcements",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        752,
        128
      ],
      "id": "a22de273-c5d6-4a16-bf9c-9eda1dc8c35d",
      "name": "get_company_announcements"
    },
    {
      "parameters": {
        "url": "=http://35.77.54.203:3003/stocks/{{ $json.stock_code }}/news/shareholders",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        880,
        128
      ],
      "id": "1c9cbc14-0a27-4925-bbb4-0dccb0bf7954",
      "name": "get_shareholder_changes"
    },
    {
      "parameters": {
        "url": "=http://35.77.54.203:3003/stocks/{{ $json.stock_code }}/news/dragon-tiger",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        1008,
        128
      ],
      "id": "54766bad-fd80-4ca4-8f29-0cfc4a1cee0b",
      "name": "get_dragon_tiger_list"
    },
    {
      "parameters": {
        "url": "=http://35.77.54.203:3003/stocks/{{ $json.stock_code }}/news/industry",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        1136,
        128
      ],
      "id": "2958727c-7872-42d2-97f8-da6fb4a98e58",
      "name": "get_industry_news"
    },
    {
      "parameters": {
        "jsCode": "// Ëé∑ÂèñÊâÄÊúâËæìÂÖ•È°π\nconst items = $input.all();\n\nif (items.length === 0) {\n  return [{ json: { error: \"No input data received.\" } }];\n}\n\n// ‰ªéÁ¨¨‰∏Ä‰∏™ËæìÂÖ•È°π‰∏≠Ëé∑ÂèñÊï∞ÊçÆ\nconst inputItem = items[0];\nlet analysisData = null;\nlet outputString = \"\";\n\n// Â∞ùËØïËé∑ÂèñoutputÂ≠óÁ¨¶‰∏≤\nif (inputItem.output) {\n  outputString = inputItem.output;\n} else if (inputItem.json && inputItem.json.output) {\n  outputString = inputItem.json.output;\n} else {\n  return [{\n    json: {\n      error: \"Input data does not contain the expected 'output' field.\"\n    }\n  }];\n}\n\n// ÊèêÂèñoutput‰∏≠ÁöÑJSONÈÉ®ÂàÜ\nconst jsonStart = outputString.indexOf('{');\nconst jsonEnd = outputString.lastIndexOf('}') + 1;\n\nif (jsonStart === -1) {\n  return [{\n    json: {\n      error: \"No JSON data found in output field - could not find opening '{'\",\n    }\n  }];\n}\n\n// ÊèêÂèñÂèØËÉΩÁöÑJSONÂ≠óÁ¨¶‰∏≤\nlet jsonString = outputString.substring(jsonStart);\nif (jsonEnd !== -1) {\n  jsonString = outputString.substring(jsonStart, jsonEnd);\n}\n\n// Â∞ùËØï‰øÆÂ§çÂ∏∏ËßÅÁöÑJSONÊ†ºÂºèÈóÆÈ¢ò\nfunction attemptFixJson(jsonStr) {\n  // Â∞ùËØï‰øÆÂ§çÊú™Èó≠ÂêàÁöÑÂºïÂè∑\n  const quoteCount = (jsonStr.match(/\"/g) || []).length;\n  if (quoteCount % 2 !== 0) {\n    jsonStr += '\"';\n  }\n  \n  // Â∞ùËØï‰øÆÂ§çÊú™Èó≠ÂêàÁöÑÂØπË±°\n  const openBraceCount = (jsonStr.match(/{/g) || []).length;\n  const closeBraceCount = (jsonStr.match(/}/g) || []).length;\n  const braceDiff = openBraceCount - closeBraceCount;\n  if (braceDiff > 0) {\n    jsonStr += '}'.repeat(braceDiff);\n  }\n  \n  // Â∞ùËØï‰øÆÂ§çÊú™Èó≠ÂêàÁöÑÊï∞ÁªÑ\n  const openBracketCount = (jsonStr.match(/\\[/g) || []).length;\n  const closeBracketCount = (jsonStr.match(/]/g) || []).length;\n  const bracketDiff = openBracketCount - closeBracketCount;\n  if (braceDiff > 0) {\n    jsonStr += ']'.repeat(bracketDiff);\n  }\n  \n  return jsonStr;\n}\n\n// Â∞ùËØïËß£ÊûêJSONÔºåÂ∏¶‰øÆÂ§çÊú∫Âà∂\ntry {\n  // ÂÖàÂ∞ùËØïÁõ¥Êé•Ëß£Êûê\n  analysisData = JSON.parse(jsonString);\n} catch (e) {\n  try {\n    // Â∞ùËØï‰øÆÂ§çÂêéÂÜçËß£Êûê\n    const fixedJson = attemptFixJson(jsonString);\n    analysisData = JSON.parse(fixedJson);\n  } catch (fixError) {\n    return [{\n      json: {\n        error: \"Failed to parse JSON from output field even after attempted fixes\",\n        original_error: e.message,\n        fix_attempt_error: fixError.message,\n        json_preview: jsonString.substring(0, 100) + \"...\" // ÊòæÁ§∫ÈÉ®ÂàÜÂÜÖÂÆπÁî®‰∫éË∞ÉËØï\n      }\n    }];\n  }\n}\n\n// ÊèêÂèñÂÖ≥ÈîÆ‰ø°ÊÅØÂπ∂Â¢ûÂº∫Êï∞ÊçÆÁªìÊûÑ\nconst result = {\n  // ÂàÜÊûêÂÖÉ‰ø°ÊÅØ\n  analysis_metadata: {\n    analysis_type: \"news_sentiment\",\n    analysis_timestamp: new Date().toISOString(),\n    data_completeness: {\n      announcements: Boolean(analysisData.key_news_summary?.significant_announcements?.length),\n      shareholder_changes: Boolean(analysisData.key_news_summary?.shareholder_movements?.length),\n      dragon_tiger_list: Boolean(analysisData.key_news_summary?.trading_anomalies?.length),\n      industry_news: Boolean(analysisData.key_news_summary?.industry_developments?.length)\n    }\n  },\n  \n  // ËÇ°Á•®Âü∫Êú¨‰ø°ÊÅØ\n  stock_info: analysisData.stock_info || {},\n  \n  // Ê†∏ÂøÉÊ∂àÊÅØÊëòË¶ÅÔºàÁªìÊûÑÂåñÔºâ\n  key_news_summary: {\n    significant_announcements: analysisData.key_news_summary?.significant_announcements || [],\n    major_shareholder_changes: analysisData.key_news_summary?.shareholder_movements || [],\n    trading_anomalies: analysisData.key_news_summary?.trading_anomalies || [],\n    industry_developments: analysisData.key_news_summary?.industry_developments || [],\n    policy_updates: analysisData.key_news_summary?.policy_news || []\n  },\n  \n  // Ê∂àÊÅØÂΩ±ÂìçÂàÜÊûêÔºàÂ¢ûÂº∫ÁâàÔºâ\n  impact_analysis: {\n    positive_factors: analysisData.impact_analysis?.positive_factors || [],\n    negative_factors: analysisData.impact_analysis?.negative_factors || [],\n    neutral_factors: analysisData.impact_analysis?.neutral_factors || [],\n    overall_bias: analysisData.comprehensive_judgment?.overall_evaluation || \"neutral\",\n    market_expectation_gap: analysisData.impact_analysis?.market_expectation_gap || \"N/A\",\n    sentiment_score: calculateSentimentScore(analysisData.impact_analysis)\n  },\n  \n  // Êó∂Èó¥Áª¥Â∫¶ÂΩ±ÂìçËØÑ‰º∞\n  time_based_impact: {\n    immediate: analysisData.time_based_impact?.immediate_impact || \"N/A\",\n    short_term: analysisData.time_based_impact?.short_term_impact || \"N/A\",\n    medium_term: analysisData.time_based_impact?.medium_term_impact || \"N/A\",\n    long_term: analysisData.time_based_impact?.long_term_impact || \"N/A\"\n  },\n  \n  // Â∏ÇÂú∫ÊÉÖÁª™ÂàÜÊûê\n  market_sentiment: {\n    institutional_viewpoints: analysisData.market_sentiment?.institutional_viewpoints || [],\n    retail_sentiment: analysisData.market_sentiment?.retail_investor_sentiment || \"neutral\",\n    capital_flow: analysisData.market_sentiment?.capital_flow || \"N/A\",\n    public_opinion_heat: analysisData.market_sentiment?.public_opinion_heat || \"medium\"\n  },\n  \n  // ÁªºÂêàÁ†îÂà§ÁªìÊûú\n  comprehensive_judgment: {\n    overall_evaluation: analysisData.comprehensive_judgment?.overall_evaluation || \"neutral\",\n    potential_stock_impact: analysisData.comprehensive_judgment?.potential_stock_impact || \"neutral\",\n    key_catalysts: analysisData.comprehensive_judgment?.key_catalysts || [],\n    risk_factors: analysisData.comprehensive_judgment?.risk_tips || [],\n    confidence_level: analysisData.metadata?.confidence_level || 7\n  },\n  \n  // ÊäïËµÑÂª∫ËÆÆÊëòË¶Å\n  investment_insights: {\n    investment_theme: extractInvestmentTheme(analysisData),\n    attention_points: extractAttentionPoints(analysisData),\n    monitoring_indicators: extractMonitoringIndicators(analysisData)\n  },\n  \n  // ÂàÜÊûêÊÄªÁªì\n  executive_summary: analysisData.analysis_summary || \"N/A\",\n  \n  // ÂÆåÊï¥ÁöÑÂéüÂßãÂàÜÊûêÊï∞ÊçÆ\n  full_analysis: analysisData\n};\n\n// ËæÖÂä©ÂáΩÊï∞ÔºöËÆ°ÁÆóÊÉÖÊÑüÂæóÂàÜ\nfunction calculateSentimentScore(impactAnalysis) {\n  if (!impactAnalysis) return 0;\n  \n  const positiveCount = (impactAnalysis.positive_factors || []).length;\n  const negativeCount = (impactAnalysis.negative_factors || []).length;\n  const neutralCount = (impactAnalysis.neutral_factors || []).length;\n  \n  const totalCount = positiveCount + negativeCount + neutralCount;\n  if (totalCount === 0) return 0;\n  \n  return ((positiveCount - negativeCount) / totalCount * 100).toFixed(1);\n}\n\n// ËæÖÂä©ÂáΩÊï∞ÔºöÊèêÂèñÊäïËµÑ‰∏ªÈ¢ò\nfunction extractInvestmentTheme(analysisData) {\n  const catalysts = analysisData.comprehensive_judgment?.key_catalysts || [];\n  if (catalysts.length > 0) {\n    return catalysts[0]; // ËøîÂõûÁ¨¨‰∏Ä‰∏™ÂÇ¨ÂåñÂõ†Á¥†‰Ωú‰∏∫‰∏ªÈ¢ò\n  }\n  return \"Ê∂àÊÅØÈù¢ÁªºÂêàÂàÜÊûê\";\n}\n\n// ËæÖÂä©ÂáΩÊï∞ÔºöÊèêÂèñÂÖ≥Ê≥®Ë¶ÅÁÇπ\nfunction extractAttentionPoints(analysisData) {\n  const points = [];\n  \n  // ‰ªéÂÖ¨Âëä‰∏≠ÊèêÂèñÂÖ≥Ê≥®ÁÇπ\n  const announcements = analysisData.key_news_summary?.significant_announcements || [];\n  announcements.forEach(ann => {\n    if (ann.importance === 'È´ò') {\n      points.push(`ÈáçË¶ÅÂÖ¨ÂëäÔºö${ann.title}`);\n    }\n  });\n  \n  // ‰ªéËÇ°‰∏úÂèòÂä®‰∏≠ÊèêÂèñÂÖ≥Ê≥®ÁÇπ\n  const shareholderChanges = analysisData.key_news_summary?.shareholder_movements || [];\n  shareholderChanges.forEach(change => {\n    if (Math.abs(parseFloat(change.ÂèòÂä®ÊØî‰æã || 0)) > 1) {\n      points.push(`ËÇ°‰∏úÂèòÂä®Ôºö${change.ËÇ°‰∏úÂêçÁß∞}${change.ÂèòÂä®Á±ªÂûã}`);\n    }\n  });\n  \n  return points.slice(0, 5); // ÊúÄÂ§öËøîÂõû5‰∏™ÂÖ≥Ê≥®ÁÇπ\n}\n\n// ËæÖÂä©ÂáΩÊï∞ÔºöÊèêÂèñÁõëÊéßÊåáÊ†á\nfunction extractMonitoringIndicators(analysisData) {\n  const indicators = [\"ËÇ°‰ª∑Ëµ∞Âäø\", \"Êàê‰∫§ÈáèÂèòÂåñ\", \"ÂêéÁª≠ÂÖ¨Âëä\"];\n  \n  // Â¶ÇÊûúÊúâÈæôËôéÊ¶úÊï∞ÊçÆÔºåÊ∑ªÂä†ËµÑÈáëÊµÅÂêëÁõëÊéß\n  const tradingAnomalies = analysisData.key_news_summary?.trading_anomalies || [];\n  if (tradingAnomalies.length > 0) {\n    indicators.push(\"‰∏ªÂäõËµÑÈáëÊµÅÂêë\");\n  }\n  \n  // Â¶ÇÊûúÊúâÊîøÁ≠ñÊ∂àÊÅØÔºåÊ∑ªÂä†ÊîøÁ≠ñË∑üË∏™\n  const policyNews = analysisData.key_news_summary?.policy_news || [];\n  if (policyNews.length > 0) {\n    indicators.push(\"Áõ∏ÂÖ≥ÊîøÁ≠ñÂä®ÊÄÅ\");\n  }\n  \n  return indicators;\n}\n\nreturn [{ json: result }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1344,
        -96
      ],
      "id": "289a9fe8-e69b-4627-8c31-13ffda26c53b",
      "name": "ÁªìÊûúÂ§ÑÁêÜ"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {
          "responseCode": 200
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1568,
        -96
      ],
      "id": "9d573e7e-4063-483c-96f1-b67c5a01746f",
      "name": "Respond to Webhook"
    }
  ],
  "pinData": {},
  "connections": {
    "Ê∂àÊÅØÈù¢ÂàÜÊûêËß¶ÂèëÂô®": {
      "main": [
        [
          {
            "node": "ÂèÇÊï∞ÊèêÂèñ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ê∂àÊÅØÈù¢ÂàÜÊûêÂ∏à": {
      "main": [
        [
          {
            "node": "ÁªìÊûúÂ§ÑÁêÜ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude 4 Sonnet": {
      "ai_languageModel": [
        [
          {
            "node": "Ê∂àÊÅØÈù¢ÂàÜÊûêÂ∏à",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "ÂèÇÊï∞ÊèêÂèñ": {
      "main": [
        [
          {
            "node": "Ê∂àÊÅØÈù¢ÂàÜÊûêÂ∏à",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_company_announcements": {
      "ai_tool": [
        [
          {
            "node": "Ê∂àÊÅØÈù¢ÂàÜÊûêÂ∏à",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get_shareholder_changes": {
      "ai_tool": [
        [
          {
            "node": "Ê∂àÊÅØÈù¢ÂàÜÊûêÂ∏à",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get_dragon_tiger_list": {
      "ai_tool": [
        [
          {
            "node": "Ê∂àÊÅØÈù¢ÂàÜÊûêÂ∏à",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get_industry_news": {
      "ai_tool": [
        [
          {
            "node": "Ê∂àÊÅØÈù¢ÂàÜÊûêÂ∏à",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "ÁªìÊûúÂ§ÑÁêÜ": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "54295ec7-1cbd-41e1-9764-ec77b623fc00",
  "meta": {
    "instanceId": "10e0bafc59087611d6c482914c57b4ec59f75077e020a64fa5f8336fb3fa7b51"
  },
  "id": "gvz3eLs4EDvr6Vjf",
  "tags": []
}