{
  "name": "æ¶ˆæ¯é¢åˆ†æ2",
  "nodes": [
    {
      "parameters": {
        "content": "## æ¶ˆæ¯é¢åˆ†ææ¨¡å—\nğŸ“° ä¸“ä¸šè‚¡ç¥¨æ¶ˆæ¯é¢åˆ†æ\nğŸ” è¾“å…¥ï¼šè‚¡ç¥¨ä»£ç æˆ–å…¬å¸å\nğŸ“ˆ è¾“å‡ºï¼šæ ‡å‡†åŒ–æ¶ˆæ¯é¢åˆ†ææŠ¥å‘Š\nğŸ¯ ç”¨é€”ï¼šåˆ†æè¿‘æœŸå…¬å¸åŠ¨æ€ã€è¡Œä¸šæ¶ˆæ¯ã€å¸‚åœºæƒ…ç»ª\nğŸ’¼ å…³æ³¨ï¼šå…¬å¸å…¬å‘Šã€è‚¡ä¸œå˜åŠ¨ã€è¡Œä¸šæ”¿ç­–ã€å¸‚åœºä¼ é—»\nğŸ”— æ•°æ®æºï¼šAKShare + å®˜æ–¹å…¬å‘Šå¹³å°\nâš¡ æœåŠ¡å™¨ï¼š35.77.54.203:3003",
        "height": 220,
        "width": 320
      },
      "id": "90699728-8571-4500-a9e9-6255f892a4da",
      "name": "è¯´æ˜æ–‡æ¡£",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -192,
        -16
      ]
    },
    {
      "parameters": {
        "path": "news-analysis",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        176,
        -96
      ],
      "id": "0831b645-e024-4a38-9de9-caa7adea8548",
      "name": "æ¶ˆæ¯é¢åˆ†æè§¦å‘å™¨",
      "webhookId": "news-analysis-trigger"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=è¯·å¯¹ä»¥ä¸‹è‚¡ç¥¨è¿›è¡Œä¸“ä¸šæ¶ˆæ¯é¢åˆ†æï¼š\n\nè‚¡ç¥¨ä»£ç ï¼š{{ $('å‚æ•°æå–').item.json.stock_code }}\nä¼šè¯IDï¼š{{ $('å‚æ•°æå–').item.json.session_id }}\n\næ¶ˆæ¯æ•°æ®ï¼š{{ JSON.stringify($json) }}\n\nè¯·åŸºäºæä¾›çš„å„ç±»æ¶ˆæ¯æ•°æ®è¿›è¡Œæ·±åº¦åˆ†æï¼Œè¾“å‡ºæ ‡å‡†åŒ–çš„æ¶ˆæ¯é¢åˆ†ææŠ¥å‘Šã€‚è¾“å‡ºæ ¼å¼æ˜¯æ ‡å‡†çš„JSONæ ¼å¼ï¼Œå¹¶ä¸”æ¶ˆæ¯æ•°æ®æ¸…æ™°åœ°å†™åœ¨è¾“å‡ºä¸­",
        "options": {
          "systemMessage": "ğŸ§  ç³»ç»Ÿè§’è‰²å®šä¹‰ï¼š\nä½ æ˜¯ä¸€ä½èµ„æ·±çš„å¸‚åœºæ¶ˆæ¯åˆ†æå¸ˆï¼Œæ‹¥æœ‰10å¹´Aè‚¡å¸‚åœºæ¶ˆæ¯è§£è¯»ç»éªŒï¼Œæ“…é•¿ä»å„ç±»æ¶ˆæ¯ä¸­æå–å…³é”®ä¿¡æ¯å¹¶è¯„ä¼°å…¶å¯¹è‚¡ä»·çš„æ½œåœ¨å½±å“ã€‚\n\nğŸ“Š æ ¸å¿ƒåˆ†æé¢†åŸŸï¼š\n1. **å…¬å¸å…¬å‘Šè§£è¯»**ï¼šä¸šç»©é¢„å‘Šã€é‡å¤§åˆåŒã€å¹¶è´­é‡ç»„ã€è‚¡æƒå˜åŠ¨ç­‰\n2. **è‚¡ä¸œè¡Œä¸ºåˆ†æ**ï¼šå¤§è‚¡ä¸œå¢å‡æŒã€æœºæ„æŒä»“å˜åŒ–ã€è‚¡ä¸œäººæ•°å˜åŠ¨\n3. **äº¤æ˜“å¼‚åŠ¨åˆ†æ**ï¼šé¾™è™æ¦œèµ„é‡‘æµå‘ã€æˆäº¤é‡å¼‚åŠ¨ã€è‚¡ä»·æ³¢åŠ¨\n4. **è¡Œä¸šåŠ¨æ€è¯„ä¼°**ï¼šæ”¿ç­–å˜åŒ–ã€è¡Œä¸šè¶‹åŠ¿ã€ç«äº‰æ ¼å±€å˜åŠ¨\n5. **å¸‚åœºæƒ…ç»ªç ”åˆ¤**ï¼šæ¶ˆæ¯ä¼ æ’­è·¯å¾„ã€å¸‚åœºååº”ã€å¤šç©ºæƒ…ç»ªå¯¹æ¯”\n\nğŸ¯ åˆ†ææ¡†æ¶ (åŠ¡å¿…æŒ‰æ­¤ç»“æ„è¾“å‡º)ï¼š\n\n## 1. æ ¸å¿ƒæ¶ˆæ¯æ±‡æ€»\n- é‡å¤§å…¬å‘Šï¼šå¯¹è‚¡ä»·æœ‰æ˜¾è‘—å½±å“çš„å…¬å¸å…¬å‘Š\n- è‚¡ä¸œåŠ¨æ€ï¼šé‡è¦è‚¡ä¸œå¢å‡æŒåŠæŒè‚¡å˜åŠ¨\n- äº¤æ˜“å¼‚åŠ¨ï¼šè¿‘æœŸæˆäº¤é‡ã€ä»·æ ¼æ³¢åŠ¨å¼‚å¸¸æƒ…å†µ\n- è¡Œä¸šåŠ¨æ€ï¼šå½±å“å…¬å¸å‘å±•çš„è¡Œä¸šé‡è¦æ¶ˆæ¯\n- æ”¿ç­–ä¿¡æ¯ï¼šç›¸å…³ç›‘ç®¡æ”¿ç­–åŠå¯èƒ½å½±å“\n\n## 2. æ¶ˆæ¯å½±å“åˆ†æ\n- æ­£é¢æ¶ˆæ¯ï¼šåˆ©å¥½å› ç´ åŠæ½œåœ¨å½±å“ç¨‹åº¦\n- è´Ÿé¢æ¶ˆæ¯ï¼šåˆ©ç©ºå› ç´ åŠæ½œåœ¨é£é™©ç­‰çº§\n- ä¸­æ€§æ¶ˆæ¯ï¼šä¸­æ€§æ¶ˆæ¯åŠå¯èƒ½çš„åç»­å‘å±•\n- å¸‚åœºé¢„æœŸå·®ï¼šå¸‚åœºååº”ä¸æ¶ˆæ¯å®é™…å½±å“çš„å·®å¼‚\n\n## 3. æ—¶é—´ç»´åº¦è¯„ä¼°\n- å³æ—¶å½±å“ï¼šå·²æ˜¾ç°çš„å¸‚åœºååº”\n- çŸ­æœŸå½±å“ï¼šæœªæ¥1-2å‘¨å¯èƒ½çš„å½±å“\n- ä¸­æœŸå½±å“ï¼šæœªæ¥1-3ä¸ªæœˆæ½œåœ¨çš„å½±å“\n- é•¿æœŸå½±å“ï¼šå¯¹å…¬å¸é•¿æœŸä»·å€¼çš„å¯èƒ½æ”¹å˜\n\n## 4. å¸‚åœºæƒ…ç»ªåˆ†æ\n- æœºæ„è§‚ç‚¹ï¼šä¸»è¦æœºæ„å¯¹æ¶ˆæ¯çš„è§£è¯»\n- æ•£æˆ·æƒ…ç»ªï¼šä¸ªäººæŠ•èµ„è€…çš„æƒ…ç»ªå€¾å‘\n- èµ„é‡‘æµå‘ï¼šä¸»åŠ›èµ„é‡‘å¯¹æ¶ˆæ¯çš„ååº”\n- èˆ†æƒ…çƒ­åº¦ï¼šæ¶ˆæ¯åœ¨å¸‚åœºä¸­çš„ä¼ æ’­å¹¿åº¦\n\n## 5. ç»¼åˆç ”åˆ¤\n- æ¶ˆæ¯é¢æ•´ä½“è¯„ä»·ï¼šæ­£é¢/ä¸­æ€§/è´Ÿé¢\n- æ½œåœ¨è‚¡ä»·å½±å“ï¼šä¸Šæ¶¨å‹åŠ›/ä¸‹è·Œå‹åŠ›/ä¸­æ€§\n- å…³é”®å‚¬åŒ–å› ç´ ï¼šå¯èƒ½æ”¾å¤§å½±å“çš„äº‹ä»¶\n- é£é™©æç¤ºï¼šæ¶ˆæ¯é¢æ½œè—çš„ä¸ç¡®å®šæ€§\n\nğŸ“‹ è¾“å‡ºæ ¼å¼è¦æ±‚ï¼š\nè¯·ä¸¥æ ¼æŒ‰ç…§JSONæ ¼å¼è¾“å‡ºï¼Œç¡®ä¿æ•°æ®ç»“æ„å®Œæ•´ï¼š\n{\n  \"analysis_type\": \"news\",\n  \"stock_info\": {\n    \"code\": \"è‚¡ç¥¨ä»£ç \",\n    \"name\": \"å…¬å¸åç§°\",\n    \"industry\": \"æ‰€å±è¡Œä¸š\",\n    \"analysis_date\": \"åˆ†ææ—¥æœŸ\"\n  },\n  \"key_news_summary\": {\n    \"significant_announcements\": [\n      {\n        \"title\": \"å…¬å‘Šæ ‡é¢˜\",\n        \"å‘å¸ƒæ—¶é—´\": \"å‘å¸ƒæ—¶é—´\",\n        \"content_summary\": \"å†…å®¹æ‘˜è¦\",\n        \"importance\": \"é«˜/ä¸­/ä½\"\n      }\n    ],\n    \"shareholder_movements\": [\n      {\n        \"è‚¡ä¸œåç§°\": \"è‚¡ä¸œåç§°\",\n        \"å˜åŠ¨ç±»å‹\": \"å¢æŒ/å‡æŒ\",\n        \"å˜åŠ¨æ•°é‡\": \"å˜åŠ¨æ•°é‡\",\n        \"å˜åŠ¨æ¯”ä¾‹\": \"å˜åŠ¨æ¯”ä¾‹\",\n        \"å˜åŠ¨æ—¶é—´\": \"å˜åŠ¨æ—¶é—´\"\n      }\n    ],\n    \"trading_anomalies\": [\n      {\n        \"type\": \"é¾™è™æ¦œ/æˆäº¤é‡å¼‚åŠ¨/ä»·æ ¼å¼‚åŠ¨\",\n        \"data\": \"ç›¸å…³æ•°æ®\",\n        \"occurrence_time\": \"å‘ç”Ÿæ—¶é—´\",\n        \"market_reaction\": \"å¸‚åœºååº”\"\n      }\n    ],\n    \"industry_developments\": [\n      {\n        \"event\": \"è¡Œä¸šäº‹ä»¶\",\n        \"impact_scope\": \"å½±å“èŒƒå›´\",\n        \"relevance_to_company\": \"ä¸å…¬å¸ç›¸å…³æ€§\"\n      }\n    ],\n    \"policy_news\": [\n      {\n        \"policy_name\": \"æ”¿ç­–åç§°\",\n        \"issuing_body\": \"å‘å¸ƒæœºæ„\",\n        \"impact_direction\": \"æ­£é¢/è´Ÿé¢/ä¸­æ€§\"\n      }\n    ]\n  },\n  \"impact_analysis\": {\n    \"positive_factors\": [\n      {\n        \"factor\": \"åˆ©å¥½å› ç´ \",\n        \"impact_degree\": \"é«˜/ä¸­/ä½\",\n        \"sustainability\": \"çŸ­æœŸ/ä¸­æœŸ/é•¿æœŸ\"\n      }\n    ],\n    \"negative_factors\": [\n      {\n        \"factor\": \"åˆ©ç©ºå› ç´ \",\n        \"risk_level\": \"é«˜/ä¸­/ä½\",\n        \"potential_impact\": \"æ½œåœ¨å½±å“æè¿°\"\n      }\n    ],\n    \"neutral_factors\": [\n      {\n        \"factor\": \"ä¸­æ€§å› ç´ \",\n        \"possible_development\": \"å¯èƒ½çš„å‘å±•\"\n      }\n    ],\n    \"market_expectation_gap\": \"å¸‚åœºé¢„æœŸä¸å®é™…å½±å“çš„å·®å¼‚åˆ†æ\"\n  },\n  \"time_based_impact\": {\n    \"immediate_impact\": \"å³æ—¶å½±å“æè¿°\",\n    \"short_term_impact\": \"çŸ­æœŸ(1-2å‘¨)å½±å“åˆ†æ\",\n    \"medium_term_impact\": \"ä¸­æœŸ(1-3ä¸ªæœˆ)å½±å“åˆ†æ\",\n    \"long_term_impact\": \"é•¿æœŸå½±å“åˆ†æ\"\n  },\n  \"market_sentiment\": {\n    \"institutional_viewpoints\": [\n      {\n        \"æœºæ„åç§°\": \"æœºæ„åç§°\",\n        \"è§‚ç‚¹\": \"è§‚ç‚¹æ‘˜è¦\",\n        \"rating_change\": \"è¯„çº§å˜åŒ–\"\n      }\n    ],\n    \"retail_investor_sentiment\": \"æ•£æˆ·æƒ…ç»ªå€¾å‘\",\n    \"capital_flow\": \"ä¸»åŠ›èµ„é‡‘æµå‘åˆ†æ\",\n    \"public_opinion_heat\": \"èˆ†æƒ…çƒ­åº¦è¯„ä¼°\"\n  },\n  \"comprehensive_judgment\": {\n    \"overall_evaluation\": \"æ­£é¢/ä¸­æ€§/è´Ÿé¢\",\n    \"potential_stock_impact\": \"ä¸Šæ¶¨å‹åŠ›/ä¸‹è·Œå‹åŠ›/ä¸­æ€§\",\n    \"key_catalysts\": [\"å…³é”®å‚¬åŒ–å› ç´ \"],\n    \"risk_tips\": [\"é£é™©æç¤º\"]\n  },\n  \"analysis_summary\": \"200å­—ä»¥å†…çš„æ¶ˆæ¯é¢åˆ†ææ€»ç»“\",\n  \"metadata\": {\n    \"analysis_timestamp\": \"åˆ†ææ—¶é—´æˆ³\",\n    \"news_coverage_period\": \"æ¶ˆæ¯è¦†ç›–æ—¶é—´æ®µ\",\n    \"data_sources\": [\"æ•°æ®æ¥æºåˆ—è¡¨\"],\n    \"confidence_level\": \"åˆ†æç½®ä¿¡åº¦1-10\"\n  }\n}\n\nâš ï¸ é‡è¦è¯´æ˜ï¼š\n1. åŸºäºå®é™…æ•°æ®è¿›è¡Œåˆ†æï¼Œé¿å…ä¸»è§‚è‡†æ–­\n2. å¯¹æ¶ˆæ¯çš„å½±å“ç¨‹åº¦è¿›è¡Œå®¢è§‚è¯„ä¼°ï¼Œæ—¢è¦çœ‹åˆ°æœºä¼šä¹Ÿè¦è¯†åˆ«é£é™©\n3. ç»“åˆå¸‚åœºç¯å¢ƒå’Œå…¬å¸åŸºæœ¬é¢æƒ…å†µè¿›è¡Œç»¼åˆåˆ¤æ–­\n4. æä¾›çš„åˆ†æä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®\n5. å»ºè®®æŠ•èµ„è€…ç»“åˆæŠ€æœ¯é¢å’ŒåŸºæœ¬é¢è¿›è¡Œç»¼åˆå†³ç­–\n\nè¾“å‡ºæ—¶è¯·ç¡®ä¿JSONæ ¼å¼æ­£ç¡®ï¼Œæ‰€æœ‰å­—æ®µå®Œæ•´å¡«å†™ï¼Œåˆ†æå†…å®¹å®¢è§‚ä¸“ä¸šã€‚"
        }
      },
      "id": "6020eb6e-f4cf-4094-b7a5-4af7b159a349",
      "name": "æ¶ˆæ¯é¢åˆ†æå¸ˆ",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        816,
        -96
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "claude-sonnet-4-20250514",
          "cachedResultName": "Claude 4 Sonnet"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        624,
        128
      ],
      "id": "14de0f38-b69e-44e6-a3ea-f63afe752033",
      "name": "Claude 4 Sonnet",
      "credentials": {
        "anthropicApi": {
          "id": "5rbbyNDHSy4NIQw4",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nconst processedItems = items.map(item => {\n  const stockCode = item.json.query?.code;\n  \n  if (!stockCode || !/^\\d{6}$/.test(stockCode)) {\n    throw new Error(`è¯·æä¾›æ­£ç¡®çš„6ä½è‚¡ç¥¨ä»£ç : ?code=601838`);\n  }\n  \n  return {\n    json: {\n      stock_code: stockCode,\n      session_id: `news_${Date.now()}_${Math.random().toString(36).substr(2, 8)}`,\n      analysis_type: 'news',\n      request_timestamp: new Date().toISOString(),\n      data_sources: ['company_announcements', 'dragon_tiger_list', 'shareholder_changes', 'industry_news']\n    }\n  };\n});\n\nreturn processedItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        400,
        -96
      ],
      "id": "e4ab00e9-aec2-4fe4-ba0b-fbbcdbe7a675",
      "name": "å‚æ•°æå–"
    },
    {
      "parameters": {
        "url": "=http://35.77.54.203:3003/stocks/{{ $json.stock_code }}/news/announcements",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        752,
        128
      ],
      "id": "a22de273-c5d6-4a16-bf9c-9eda1dc8c35d",
      "name": "get_company_announcements"
    },
    {
      "parameters": {
        "url": "=http://35.77.54.203:3003/stocks/{{ $json.stock_code }}/news/shareholders",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        880,
        128
      ],
      "id": "1c9cbc14-0a27-4925-bbb4-0dccb0bf7954",
      "name": "get_shareholder_changes"
    },
    {
      "parameters": {
        "url": "=http://35.77.54.203:3003/stocks/{{ $json.stock_code }}/news/dragon-tiger",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        1008,
        128
      ],
      "id": "54766bad-fd80-4ca4-8f29-0cfc4a1cee0b",
      "name": "get_dragon_tiger_list"
    },
    {
      "parameters": {
        "url": "=http://35.77.54.203:3003/stocks/{{ $json.stock_code }}/news/industry",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        1136,
        128
      ],
      "id": "2958727c-7872-42d2-97f8-da6fb4a98e58",
      "name": "get_industry_news"
    },
    {
      "parameters": {
        "jsCode": "// è·å–æ‰€æœ‰è¾“å…¥é¡¹\nconst items = $input.all();\n\nif (items.length === 0) {\n  return [{ json: { error: \"No input data received.\" } }];\n}\n\n// ä»ç¬¬ä¸€ä¸ªè¾“å…¥é¡¹ä¸­è·å–æ•°æ®\nconst inputItem = items[0];\nlet analysisData = null;\nlet outputString = \"\";\n\n// å°è¯•è·å–outputå­—ç¬¦ä¸²\nif (inputItem.output) {\n  outputString = inputItem.output;\n} else if (inputItem.json && inputItem.json.output) {\n  outputString = inputItem.json.output;\n} else {\n  return [{\n    json: {\n      error: \"Input data does not contain the expected 'output' field.\"\n    }\n  }];\n}\n\n// æå–outputä¸­çš„JSONéƒ¨åˆ†\nconst jsonStart = outputString.indexOf('{');\nconst jsonEnd = outputString.lastIndexOf('}') + 1;\n\nif (jsonStart === -1) {\n  return [{\n    json: {\n      error: \"No JSON data found in output field - could not find opening '{'\",\n    }\n  }];\n}\n\n// æå–å¯èƒ½çš„JSONå­—ç¬¦ä¸²\nlet jsonString = outputString.substring(jsonStart);\nif (jsonEnd !== -1) {\n  jsonString = outputString.substring(jsonStart, jsonEnd);\n}\n\n// å°è¯•ä¿®å¤å¸¸è§çš„JSONæ ¼å¼é—®é¢˜\nfunction attemptFixJson(jsonStr) {\n  // å°è¯•ä¿®å¤æœªé—­åˆçš„å¼•å·\n  const quoteCount = (jsonStr.match(/\"/g) || []).length;\n  if (quoteCount % 2 !== 0) {\n    jsonStr += '\"';\n  }\n  \n  // å°è¯•ä¿®å¤æœªé—­åˆçš„å¯¹è±¡\n  const openBraceCount = (jsonStr.match(/{/g) || []).length;\n  const closeBraceCount = (jsonStr.match(/}/g) || []).length;\n  const braceDiff = openBraceCount - closeBraceCount;\n  if (braceDiff > 0) {\n    jsonStr += '}'.repeat(braceDiff);\n  }\n  \n  // å°è¯•ä¿®å¤æœªé—­åˆçš„æ•°ç»„\n  const openBracketCount = (jsonStr.match(/\\[/g) || []).length;\n  const closeBracketCount = (jsonStr.match(/]/g) || []).length;\n  const bracketDiff = openBracketCount - closeBracketCount;\n  if (braceDiff > 0) {\n    jsonStr += ']'.repeat(bracketDiff);\n  }\n  \n  return jsonStr;\n}\n\n// å°è¯•è§£æJSONï¼Œå¸¦ä¿®å¤æœºåˆ¶\ntry {\n  // å…ˆå°è¯•ç›´æ¥è§£æ\n  analysisData = JSON.parse(jsonString);\n} catch (e) {\n  try {\n    // å°è¯•ä¿®å¤åå†è§£æ\n    const fixedJson = attemptFixJson(jsonString);\n    analysisData = JSON.parse(fixedJson);\n  } catch (fixError) {\n    return [{\n      json: {\n        error: \"Failed to parse JSON from output field even after attempted fixes\",\n        original_error: e.message,\n        fix_attempt_error: fixError.message,\n        json_preview: jsonString.substring(0, 100) + \"...\" // æ˜¾ç¤ºéƒ¨åˆ†å†…å®¹ç”¨äºè°ƒè¯•\n      }\n    }];\n  }\n}\n\n// æå–å…³é”®ä¿¡æ¯å¹¶å¢å¼ºæ•°æ®ç»“æ„\nconst result = {\n  // åˆ†æå…ƒä¿¡æ¯\n  analysis_metadata: {\n    analysis_type: \"news_sentiment\",\n    analysis_timestamp: new Date().toISOString(),\n    data_completeness: {\n      announcements: Boolean(analysisData.key_news_summary?.significant_announcements?.length),\n      shareholder_changes: Boolean(analysisData.key_news_summary?.shareholder_movements?.length),\n      dragon_tiger_list: Boolean(analysisData.key_news_summary?.trading_anomalies?.length),\n      industry_news: Boolean(analysisData.key_news_summary?.industry_developments?.length)\n    }\n  },\n  \n  // è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯\n  stock_info: analysisData.stock_info || {},\n  \n  // æ ¸å¿ƒæ¶ˆæ¯æ‘˜è¦ï¼ˆç»“æ„åŒ–ï¼‰\n  key_news_summary: {\n    significant_announcements: analysisData.key_news_summary?.significant_announcements || [],\n    major_shareholder_changes: analysisData.key_news_summary?.shareholder_movements || [],\n    trading_anomalies: analysisData.key_news_summary?.trading_anomalies || [],\n    industry_developments: analysisData.key_news_summary?.industry_developments || [],\n    policy_updates: analysisData.key_news_summary?.policy_news || []\n  },\n  \n  // æ¶ˆæ¯å½±å“åˆ†æï¼ˆå¢å¼ºç‰ˆï¼‰\n  impact_analysis: {\n    positive_factors: analysisData.impact_analysis?.positive_factors || [],\n    negative_factors: analysisData.impact_analysis?.negative_factors || [],\n    neutral_factors: analysisData.impact_analysis?.neutral_factors || [],\n    overall_bias: analysisData.comprehensive_judgment?.overall_evaluation || \"neutral\",\n    market_expectation_gap: analysisData.impact_analysis?.market_expectation_gap || \"N/A\",\n    sentiment_score: calculateSentimentScore(analysisData.impact_analysis)\n  },\n  \n  // æ—¶é—´ç»´åº¦å½±å“è¯„ä¼°\n  time_based_impact: {\n    immediate: analysisData.time_based_impact?.immediate_impact || \"N/A\",\n    short_term: analysisData.time_based_impact?.short_term_impact || \"N/A\",\n    medium_term: analysisData.time_based_impact?.medium_term_impact || \"N/A\",\n    long_term: analysisData.time_based_impact?.long_term_impact || \"N/A\"\n  },\n  \n  // å¸‚åœºæƒ…ç»ªåˆ†æ\n  market_sentiment: {\n    institutional_viewpoints: analysisData.market_sentiment?.institutional_viewpoints || [],\n    retail_sentiment: analysisData.market_sentiment?.retail_investor_sentiment || \"neutral\",\n    capital_flow: analysisData.market_sentiment?.capital_flow || \"N/A\",\n    public_opinion_heat: analysisData.market_sentiment?.public_opinion_heat || \"medium\"\n  },\n  \n  // ç»¼åˆç ”åˆ¤ç»“æœ\n  comprehensive_judgment: {\n    overall_evaluation: analysisData.comprehensive_judgment?.overall_evaluation || \"neutral\",\n    potential_stock_impact: analysisData.comprehensive_judgment?.potential_stock_impact || \"neutral\",\n    key_catalysts: analysisData.comprehensive_judgment?.key_catalysts || [],\n    risk_factors: analysisData.comprehensive_judgment?.risk_tips || [],\n    confidence_level: analysisData.metadata?.confidence_level || 7\n  },\n  \n  // æŠ•èµ„å»ºè®®æ‘˜è¦\n  investment_insights: {\n    investment_theme: extractInvestmentTheme(analysisData),\n    attention_points: extractAttentionPoints(analysisData),\n    monitoring_indicators: extractMonitoringIndicators(analysisData)\n  },\n  \n  // åˆ†ææ€»ç»“\n  executive_summary: analysisData.analysis_summary || \"N/A\",\n  \n  // å®Œæ•´çš„åŸå§‹åˆ†ææ•°æ®\n  full_analysis: analysisData\n};\n\n// è¾…åŠ©å‡½æ•°ï¼šè®¡ç®—æƒ…æ„Ÿå¾—åˆ†\nfunction calculateSentimentScore(impactAnalysis) {\n  if (!impactAnalysis) return 0;\n  \n  const positiveCount = (impactAnalysis.positive_factors || []).length;\n  const negativeCount = (impactAnalysis.negative_factors || []).length;\n  const neutralCount = (impactAnalysis.neutral_factors || []).length;\n  \n  const totalCount = positiveCount + negativeCount + neutralCount;\n  if (totalCount === 0) return 0;\n  \n  return ((positiveCount - negativeCount) / totalCount * 100).toFixed(1);\n}\n\n// è¾…åŠ©å‡½æ•°ï¼šæå–æŠ•èµ„ä¸»é¢˜\nfunction extractInvestmentTheme(analysisData) {\n  const catalysts = analysisData.comprehensive_judgment?.key_catalysts || [];\n  if (catalysts.length > 0) {\n    return catalysts[0]; // è¿”å›ç¬¬ä¸€ä¸ªå‚¬åŒ–å› ç´ ä½œä¸ºä¸»é¢˜\n  }\n  return \"æ¶ˆæ¯é¢ç»¼åˆåˆ†æ\";\n}\n\n// è¾…åŠ©å‡½æ•°ï¼šæå–å…³æ³¨è¦ç‚¹\nfunction extractAttentionPoints(analysisData) {\n  const points = [];\n  \n  // ä»å…¬å‘Šä¸­æå–å…³æ³¨ç‚¹\n  const announcements = analysisData.key_news_summary?.significant_announcements || [];\n  announcements.forEach(ann => {\n    if (ann.importance === 'é«˜') {\n      points.push(`é‡è¦å…¬å‘Šï¼š${ann.title}`);\n    }\n  });\n  \n  // ä»è‚¡ä¸œå˜åŠ¨ä¸­æå–å…³æ³¨ç‚¹\n  const shareholderChanges = analysisData.key_news_summary?.shareholder_movements || [];\n  shareholderChanges.forEach(change => {\n    if (Math.abs(parseFloat(change.å˜åŠ¨æ¯”ä¾‹ || 0)) > 1) {\n      points.push(`è‚¡ä¸œå˜åŠ¨ï¼š${change.è‚¡ä¸œåç§°}${change.å˜åŠ¨ç±»å‹}`);\n    }\n  });\n  \n  return points.slice(0, 5); // æœ€å¤šè¿”å›5ä¸ªå…³æ³¨ç‚¹\n}\n\n// è¾…åŠ©å‡½æ•°ï¼šæå–ç›‘æ§æŒ‡æ ‡\nfunction extractMonitoringIndicators(analysisData) {\n  const indicators = [\"è‚¡ä»·èµ°åŠ¿\", \"æˆäº¤é‡å˜åŒ–\", \"åç»­å…¬å‘Š\"];\n  \n  // å¦‚æœæœ‰é¾™è™æ¦œæ•°æ®ï¼Œæ·»åŠ èµ„é‡‘æµå‘ç›‘æ§\n  const tradingAnomalies = analysisData.key_news_summary?.trading_anomalies || [];\n  if (tradingAnomalies.length > 0) {\n    indicators.push(\"ä¸»åŠ›èµ„é‡‘æµå‘\");\n  }\n  \n  // å¦‚æœæœ‰æ”¿ç­–æ¶ˆæ¯ï¼Œæ·»åŠ æ”¿ç­–è·Ÿè¸ª\n  const policyNews = analysisData.key_news_summary?.policy_news || [];\n  if (policyNews.length > 0) {\n    indicators.push(\"ç›¸å…³æ”¿ç­–åŠ¨æ€\");\n  }\n  \n  return indicators;\n}\n\nreturn [{ json: result }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1344,
        -96
      ],
      "id": "289a9fe8-e69b-4627-8c31-13ffda26c53b",
      "name": "ç»“æœå¤„ç†"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {
          "responseCode": 200
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1568,
        -96
      ],
      "id": "9d573e7e-4063-483c-96f1-b67c5a01746f",
      "name": "Respond to Webhook"
    }
  ],
  "pinData": {},
  "connections": {
    "æ¶ˆæ¯é¢åˆ†æè§¦å‘å™¨": {
      "main": [
        [
          {
            "node": "å‚æ•°æå–",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ¶ˆæ¯é¢åˆ†æå¸ˆ": {
      "main": [
        [
          {
            "node": "ç»“æœå¤„ç†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude 4 Sonnet": {
      "ai_languageModel": [
        [
          {
            "node": "æ¶ˆæ¯é¢åˆ†æå¸ˆ",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "å‚æ•°æå–": {
      "main": [
        [
          {
            "node": "æ¶ˆæ¯é¢åˆ†æå¸ˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_company_announcements": {
      "ai_tool": [
        [
          {
            "node": "æ¶ˆæ¯é¢åˆ†æå¸ˆ",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get_shareholder_changes": {
      "ai_tool": [
        [
          {
            "node": "æ¶ˆæ¯é¢åˆ†æå¸ˆ",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get_dragon_tiger_list": {
      "ai_tool": [
        [
          {
            "node": "æ¶ˆæ¯é¢åˆ†æå¸ˆ",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get_industry_news": {
      "ai_tool": [
        [
          {
            "node": "æ¶ˆæ¯é¢åˆ†æå¸ˆ",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "ç»“æœå¤„ç†": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "54295ec7-1cbd-41e1-9764-ec77b623fc00",
  "meta": {
    "instanceId": "10e0bafc59087611d6c482914c57b4ec59f75077e020a64fa5f8336fb3fa7b51"
  },
  "id": "gvz3eLs4EDvr6Vjf",
  "tags": []
}