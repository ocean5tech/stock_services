{
  "name": "AI新闻分析工作流_0828",
  "nodes": [
    {
      "parameters": {
        "content": "## AI新闻分析工作流 - 最终优化版\n✅ 修复邮件格式化问题\n✅ 修复PostgreSQL ID重复问题\n✅ 使用UPSERT避免重复插入\n✅ HTML格式邮件内容",
        "height": 180,
        "width": 250
      },
      "id": "2d78a4f8-2ec4-4708-8ab4-16f66d641841",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -768,
        -224
      ]
    },
    {
      "parameters": {
        "path": "news-analysis-webhook",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -800,
        0
      ],
      "id": "65946aa8-f884-490c-9fed-5414947d5e8a",
      "name": "Webhook",
      "webhookId": "23136ca0-f84a-44f9-9113-088edc6643cf"
    },
    {
      "parameters": {
        "url": "https://feeds.bloomberg.com/markets/news.rss",
        "options": {
          "ignoreSSL": true
        }
      },
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1.2,
      "position": [
        -576,
        0
      ],
      "id": "dd0e0e72-35b5-41b1-81d1-81c1f805d8ae",
      "name": "RSS Read"
    },
    {
      "parameters": {
        "jsCode": "// RSS Read输出数据预处理 - 修正变量命名和数据保留\nconst items = $input.all();\nconst limitedItems = items.slice(0, 5);\n\n// 处理RSS数据，确保所有原始数据都被保留\nconst processedItems = limitedItems.map(item => {\n  const data = item.json;\n  \n  // 构建Agent期望的chatInput格式\n  const chatInput = {\n    title: data.title || '未知标题',\n    content: data.content || data.description || data.summary || '',\n    link: data.link || data.url || '',\n    pubDate: data.pubDate || data.isoDate || new Date().toISOString(),\n    author: data.author || data.creator || '未知作者',\n    categories: data.categories || [],\n    // 组合完整的新闻文本供AI分析\n    fullText: `标题: ${data.title || ''}\\n\\n内容: ${data.content || data.description || data.summary || ''}\\n\\n链接: ${data.link || ''}\\n\\n发布时间: ${data.pubDate || data.isoDate || ''}`\n  };\n\n  return {\n    json: {\n      // AI Agent需要的输入\n      chatInput: chatInput.fullText,\n      // 保留完整的新闻数据供后续节点使用\n      newsData: chatInput,\n      originalRssData: data,\n      // 生成唯一的会话ID\n      sessionId: `news_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`,\n      // 直接传递标题和URL，确保后续节点能获取到\n      newsTitle: data.title || '未知标题',\n      newsUrl: data.link || data.url || '',\n      newsAuthor: data.author || data.creator || '未知作者',\n      newsPubDate: data.pubDate || data.isoDate || null\n    }\n  };\n});\n\nreturn processedItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -352,
        0
      ],
      "id": "a2ea0b8f-fc7f-49cf-8d90-43bc7ac27161",
      "name": "RSS数据预处理"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=请分析以下新闻内容：{{ $json.chatInput }}\n\n请务必通过HTTP API工具验证股票信息并输出JSON分析结果。",
        "options": {
          "systemMessage": "🧠 系统提示词：\n\n你是一个专门服务于 n8n 工作流的中国 A 股市场新闻分析 AI 代理。你的任务是基于输入的新闻内容，识别其中具备明确因果链条的事件对个股价格的影响，并在确认逻辑闭环成立的前提下，做出“买入”或“卖出”的投资级别推荐；若事件本身影响力不足、关联性不强或缺乏明确信号，则不推荐股票，仅做评论性分析或行业判断。\n\n🌏 语言要求：\n\n所有分析和输出必须为简体中文\n\n即使输入新闻是英文，分析结果也必须为中文\n\n所有 JSON 字段值均用中文填写\n\n内容需确保适合中国用户阅读理解\n\n🎯 工作流程\n第1步：新闻解析与影响识别\n\n仅分析事实性新闻（如政策落地、产业事故、经济数据、企业公告等），忽略评论性、预测性或主观观点类文章\n\n提炼核心事件（例如：铜矿崩塌、某项政策发布、生物科技技术突破等）\n\n明确涉及的概念板块或行业领域（如：有色金属、新能源、AI芯片等）\n\n判断预期影响方向（正面/负面/中性）\n\n第2步：相关股票识别与API调用\n\n基于新闻中的关键事实，识别最多5只与事件具备强关联逻辑的 A 股股票\n\n只能在具有关联行业内进行推荐；若新闻未指向具体行业，不推荐个股\n\n调用以下 API 查询股票信息：\n\n格式：http://35.77.54.203:3003/stocks/{stock_code}?refresh=false\n\n示例：http://35.77.54.203:3003/stocks/002366?refresh=false\n\n获取以下股票字段信息：当前价格、所属概念、市值等\n\n第3步：五维度严谨分析\n\n使用以下五维度框架判断该事件是否具备直接影响股价的逻辑闭环：\n\n📊 行业结构分析：新闻事件是否对所处行业产生结构性冲击或利好？\n📈 产业链上下游影响分析：事件对供应链上下游是否有传导性？\n🔍 当前市场趋势叠加分析：事件是否与当前主流行情/热点产生共振？\n📚 历史相似事件对比：历史上类似事件是否对股价产生显著影响？\n📍 地域与政策叠加影响：是否涉及区域政策倾斜、本地资源等特殊因素？\n\n第4步：股票推荐条件审查\n\n仅在以下条件同时满足时才推荐股票，并标记“买入”或“卖出”：\n\n新闻事件事实明确、可追踪；\n\n股票与事件具备清晰推理链条（例如“铜矿事故 ➝ 铜供应收缩 ➝ 铜价上涨 ➝ 国内铜生产企业受益”）；\n\n行业内一致性：若新闻确定行业，推荐股票必须归属于该行业；\n\n经 API 验证的基本面信息支撑逻辑成立。\n\n若上述任一条件未满足，不推荐个股，只输出行业分析和影响判断\n\n📋 输出格式要求 - 严格使用以下 JSON 格式，字段说明如下：\n{\n  \"news_source\": {\n    \"original_title\": \"保留原始标题\",\n    \"chinese_title\": \"中文翻译标题\",\n    \"original_url\": \"原始新闻链接\",\n    \"publish_time\": \"发布时间\",\n    \"analysis_timestamp\": \"分析时间戳\"\n  },\n  \"news_analysis\": {\n    \"core_event\": \"核心事件描述（中文）\",\n    \"impact_direction\": \"正面/负面/中性\",\n    \"affected_industries\": [\"行业1（中文）\", \"行业2（中文）\"],\n    \"impact_magnitude\": \"高/中/低\"\n  },\n  \"stock_recommendations\": [\n    {\n      \"stock_code\": \"000001\",\n      \"stock_name\": \"股票名称（中文）\",\n      \"current_price\": 10.50,\n      \"recommendation\": \"买入/卖出\",\n      \"target_price\": \"目标价格区间（如：12~13元）\",\n      \"four_dimensional_score\": 8.5,\n      \"key_rationale\": \"推荐核心理由，清晰表述事件影响路径及逻辑链条\",\n      \"risk_factors\": [\"风险因素1（中文）\", \"风险因素2（中文）\"],\n      \"api_data_verified\": true\n    }\n  ],\n  \"execution_summary\": {\n    \"api_calls_made\": 3,\n    \"stocks_analyzed\": [\"002366\", \"600362\"],\n    \"processing_timestamp\": \"2025-08-27T10:30:00Z\",\n    \"confidence_level\": \"高/中/低\"\n  }\n}\n\n⚠️ 重要注意事项\n\n如果输入新闻缺失以下任意一项关键信息（如标题、正文、时间、链接），则中止后续分析；\n\n不要伪造“未知作者”、“解析错误”这类占位符字段；\n\n在此类场景下，返回如下结构（只输出一次标准错误 JSON）：\n\n{\n  \"error\": {\n    \"message\": \"新闻内容无法解析，可能缺少标题或正文，或格式错误。\",\n    \"reason\": \"missing_title_or_body\",\n    \"suggestion\": \"请检查输入的新闻文本格式，确保包含清晰的标题和正文内容。\"\n  },\n  \"stock_recommendations\": []\n}\n\n\n不要输出 \"news_source\"、\"news_analysis\" 或 \"execution_summary\" 字段；\n\n若能解析但判断不建议推荐股票，仍正常输出 JSON，只将 \"stock_recommendations\" 设置为空数组即可。\n\n必须调用 API 核实股票信息，严禁凭空推荐\n\n严格控制推荐数量（最多5只，非必须推荐）\n\n输出 JSON 格式必须合法，字段完整\n\n所有输出信息必须为简体中文\n"
        }
      },
      "id": "c63c4ad4-4274-4421-9190-5df555ce9102",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -128,
        0
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "claude-sonnet-4-20250514",
          "cachedResultName": "Claude 4 Sonnet"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -208,
        240
      ],
      "id": "f6fd998a-50d8-41c0-b3de-9acf5a0b28c0",
      "name": "Anthropic Chat Model",
      "credentials": {
        "anthropicApi": {
          "id": "5rbbyNDHSy4NIQw4",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        128,
        240
      ],
      "id": "9e21abb5-7bf3-4146-874d-0f89ef124950",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "jsCode": "// Agent输出处理 - 确保数据完整传递\nconst items = $input.all();\n\n// 处理每个Agent的输出\nconst processedItems = items.map(item => {\n  const agentOutput = item.json.output || item.json.response || item.json;\n  const inputData = item.json; // 保留输入数据\n  \n  let analysisData = {};\n  \n  try {\n    // 解析Agent输出的JSON\n    if (typeof agentOutput === 'string') {\n      const jsonMatch = agentOutput.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n      if (jsonMatch) {\n        analysisData = JSON.parse(jsonMatch[1]);\n      } else {\n        analysisData = JSON.parse(agentOutput);\n      }\n    } else if (typeof agentOutput === 'object') {\n      analysisData = agentOutput;\n    }\n  } catch (error) {\n    console.log('解析Agent输出失败:', error.message);\n    analysisData = {\n      news_source: {\n        original_title: inputData.newsTitle || '解析错误',\n        original_url: inputData.newsUrl || '',\n        analysis_timestamp: new Date().toISOString()\n      },\n      news_analysis: {\n        core_event: '分析过程中出现错误',\n        impact_direction: '未知',\n        affected_industries: ['解析错误']\n      },\n      stock_recommendations: [],\n      error_message: error.message\n    };\n  }\n  \n  // 确保新闻源信息完整\n  if (!analysisData.news_source) {\n    analysisData.news_source = {};\n  }\n  analysisData.news_source.original_title = analysisData.news_source.original_title || inputData.newsTitle || '未知新闻';\n  analysisData.news_source.original_url = analysisData.news_source.original_url || inputData.newsUrl || '';\n  \n  return {\n    json: {\n      // 保留所有输入数据\n      newsTitle: inputData.newsTitle,\n      newsUrl: inputData.newsUrl,\n      newsAuthor: inputData.newsAuthor,\n      newsPubDate: inputData.newsPubDate,\n      newsData: inputData.newsData,\n      originalRssData: inputData.originalRssData,\n      \n      // Agent分析结果\n      originalAnalysis: analysisData,\n      analysisJson: JSON.stringify(analysisData, null, 2),\n      \n      // 处理状态\n      success: true,\n      processedAt: new Date().toISOString()\n    }\n  };\n});\n\nreturn processedItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        224,
        0
      ],
      "id": "5f3f4999-40f5-432b-a1ce-689754d0d757",
      "name": "Agent输出处理"
    },
    {
      "parameters": {
        "jsCode": "// PostgreSQL数据映射和邮件内容生成 - HTML格式\nconst items = $input.all();\n\n// 生成HTML格式的详细邮件内容\nconst generateDetailedEmailContent = (analysis, title, url, author, pubDate) => {\n  let html = `<html><body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333;\">`;\n  \n  // 标题\n  html += `<h2 style=\"color: #2c5aa0; border-bottom: 2px solid #2c5aa0; padding-bottom: 10px;\">📊 AI股票投资分析报告</h2>`;\n  \n  // 新闻基本信息\n  html += `<div style=\"background-color: #f8f9fa; padding: 15px; border-left: 4px solid #007bff; margin: 20px 0;\">`;\n  html += `<h3 style=\"color: #007bff; margin-top: 0;\">📰 新闻信息</h3>`;\n  html += `<p><strong>标题：</strong>${title}</p>`;\n  html += `<p><strong>作者：</strong>${author}</p>`;\n  html += `<p><strong>发布时间：</strong>${pubDate ? new Date(pubDate).toLocaleString('zh-CN') : '未知'}</p>`;\n  if (url) {\n    html += `<p><strong>链接：</strong><a href=\"${url}\" target=\"_blank\">${url}</a></p>`;\n  }\n  html += `</div>`;\n  \n  // 如果有分析数据\n  if (analysis && Object.keys(analysis).length > 0) {\n    // 核心分析\n    if (analysis.news_analysis) {\n      const newsAnalysis = analysis.news_analysis;\n      html += `<div style=\"background-color: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; margin: 20px 0;\">`;\n      html += `<h3 style=\"color: #856404; margin-top: 0;\">🎯 核心分析</h3>`;\n      html += `<p><strong>核心事件：</strong>${newsAnalysis.core_event || '未识别'}</p>`;\n      html += `<p><strong>影响方向：</strong><span style=\"color: ${newsAnalysis.impact_direction === '正面' ? 'green' : newsAnalysis.impact_direction === '负面' ? 'red' : 'orange'}; font-weight: bold;\">${newsAnalysis.impact_direction || '中性'}</span></p>`;\n      html += `<p><strong>影响程度：</strong>${newsAnalysis.impact_magnitude || '中等'}</p>`;\n      if (newsAnalysis.affected_industries && newsAnalysis.affected_industries.length > 0) {\n        html += `<p><strong>涉及行业：</strong>${newsAnalysis.affected_industries.join('、')}</p>`;\n      }\n      html += `</div>`;\n    }\n    \n    // 股票推荐详情\n    if (analysis.stock_recommendations && analysis.stock_recommendations.length > 0) {\n      html += `<div style=\"background-color: #d4edda; padding: 15px; border-left: 4px solid #28a745; margin: 20px 0;\">`;\n      html += `<h3 style=\"color: #155724; margin-top: 0;\">📈 股票推荐详情 (${analysis.stock_recommendations.length}只)</h3>`;\n      \n      analysis.stock_recommendations.forEach((stock, index) => {\n        html += `<div style=\"background: white; padding: 15px; margin: 10px 0; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">`;\n        html += `<h4 style=\"color: #2c5aa0; margin-top: 0;\">${index + 1}. 【${stock.stock_code}】${stock.stock_name || '未知股票'}</h4>`;\n        html += `<table style=\"width: 100%; border-collapse: collapse;\">`;\n        html += `<tr><td style=\"padding: 5px; border-bottom: 1px solid #eee;\"><strong>💰 当前价格：</strong></td><td style=\"padding: 5px; border-bottom: 1px solid #eee;\">¥${stock.current_price || 'N/A'}</td></tr>`;\n        html += `<tr><td style=\"padding: 5px; border-bottom: 1px solid #eee;\"><strong>📊 推荐评级：</strong></td><td style=\"padding: 5px; border-bottom: 1px solid #eee; font-weight: bold; color: ${stock.recommendation === '买入' || stock.recommendation === '强烈买入' ? 'green' : stock.recommendation === '卖出' || stock.recommendation === '减持' ? 'red' : 'orange'};\">${stock.recommendation || 'N/A'}</td></tr>`;\n        if (stock.target_price) {\n          html += `<tr><td style=\"padding: 5px; border-bottom: 1px solid #eee;\"><strong>🎯 目标价位：</strong></td><td style=\"padding: 5px; border-bottom: 1px solid #eee;\">${stock.target_price}</td></tr>`;\n        }\n        if (stock.four_dimensional_score) {\n          html += `<tr><td style=\"padding: 5px; border-bottom: 1px solid #eee;\"><strong>⭐ 综合评分：</strong></td><td style=\"padding: 5px; border-bottom: 1px solid #eee; font-weight: bold;\">${stock.four_dimensional_score}/10</td></tr>`;\n        }\n        html += `</table>`;\n        if (stock.key_rationale) {\n          html += `<p style=\"background: #f8f9fa; padding: 10px; border-radius: 3px; margin: 10px 0;\"><strong>📝 推荐理由：</strong><br>${stock.key_rationale}</p>`;\n        }\n        if (stock.risk_factors && stock.risk_factors.length > 0) {\n          html += `<p style=\"background: #fff3cd; padding: 10px; border-radius: 3px; margin: 10px 0; border-left: 3px solid #ffc107;\"><strong>⚠️ 风险提示：</strong><br>${stock.risk_factors.join('、')}</p>`;\n        }\n        if (stock.api_data_verified) {\n          html += `<p style=\"color: green; font-size: 12px;\">✅ API数据已验证</p>`;\n        }\n        html += `</div>`;\n      });\n      html += `</div>`;\n    }\n    \n    // 执行摘要\n    if (analysis.execution_summary) {\n      const execSummary = analysis.execution_summary;\n      html += `<div style=\"background-color: #e2e3e5; padding: 15px; border-left: 4px solid #6c757d; margin: 20px 0;\">`;\n      html += `<h3 style=\"color: #495057; margin-top: 0;\">📋 执行摘要</h3>`;\n      html += `<p><strong>API调用次数：</strong>${execSummary.api_calls_made || 0}次</p>`;\n      if (execSummary.stocks_analyzed && execSummary.stocks_analyzed.length > 0) {\n        html += `<p><strong>分析股票代码：</strong>${execSummary.stocks_analyzed.join('、')}</p>`;\n      }\n      html += `<p><strong>分析置信度：</strong><span style=\"font-weight: bold; color: ${execSummary.confidence_level === '高' ? 'green' : execSummary.confidence_level === '低' ? 'red' : 'orange'};\">${execSummary.confidence_level || '中等'}</span></p>`;\n      if (execSummary.error_message) {\n        html += `<p style=\"color: red;\"><strong>错误信息：</strong>${execSummary.error_message}</p>`;\n      }\n      html += `</div>`;\n    }\n  } else {\n    html += `<div style=\"background-color: #f8d7da; padding: 15px; border-left: 4px solid #dc3545; margin: 20px 0;\">`;\n    html += `<p style=\"color: #721c24; font-weight: bold;\">❌ AI分析过程中出现问题，未能生成有效的投资建议。</p>`;\n    html += `</div>`;\n  }\n  \n  // 免责声明\n  html += `<div style=\"background-color: #f8d7da; padding: 15px; border: 2px solid #dc3545; border-radius: 5px; margin: 20px 0;\">`;\n  html += `<h3 style=\"color: #721c24; margin-top: 0;\">⚠️ 风险提示</h3>`;\n  html += `<p style=\"color: #721c24;\">本分析报告由AI算法生成，仅供参考，不构成投资建议。<br>`;\n  html += `股市有风险，投资需谨慎。请根据个人风险承受能力做出投资决策。<br>`;\n  html += `建议结合多方面信息和专业人士意见后再做决定。</p>`;\n  html += `</div>`;\n  \n  // 报告信息\n  html += `<div style=\"background-color: #d1ecf1; padding: 15px; border-left: 4px solid #17a2b8; margin: 20px 0;\">`;\n  html += `<h3 style=\"color: #0c5460; margin-top: 0;\">📊 报告信息</h3>`;\n  html += `<p><strong>生成时间：</strong>${new Date().toLocaleString('zh-CN')}</p>`;\n  html += `<p><strong>数据来源：</strong>Bloomberg RSS + 实时股票API</p>`;\n  html += `<p><strong>分析引擎：</strong>Claude 4 Sonnet AI</p>`;\n  html += `</div>`;\n  \n  html += `</body></html>`;\n  return html;\n};\n\nconst processedItems = items.map(item => {\n  const data = item.json;\n  const analysis = data.originalAnalysis || {};\n  \n  // 优先从多个数据源获取新闻信息\n  const newsTitle = data.newsTitle || \n                   data.newsData?.title || \n                   analysis.news_source?.original_title ||\n                   '未知新闻标题';\n  \n  const newsUrl = data.newsUrl || \n                 data.newsData?.link || \n                 analysis.news_source?.original_url ||\n                 '';\n  \n  const newsAuthor = data.newsAuthor || \n                    data.newsData?.author ||\n                    '未知作者';\n  \n  const pubDate = data.newsPubDate || \n                 data.newsData?.pubDate;\n  \n  // 生成基于实际标题的content_hash\n  const generateContentHash = (title) => {\n    const cleanTitle = title.replace(/[^a-zA-Z0-9\\u4e00-\\u9fa5]/g, '_').substring(0, 20);\n    const timestamp = Date.now();\n    const random = Math.random().toString(36).substring(2, 6);\n    return `${cleanTitle}_${timestamp}_${random}`;\n  };\n  \n  // 提取域名\n  const extractDomain = (url) => {\n    if (!url) return null;\n    try {\n      return new URL(url).hostname;\n    } catch {\n      return 'unknown';\n    }\n  };\n  \n  // 计算分析质量评分\n  const calculateQualityScore = (analysis) => {\n    let score = 3; // 基础分\n    if (analysis.stock_recommendations?.length > 0) score += 3;\n    if (analysis.news_analysis?.core_event) score += 2;\n    if (analysis.news_analysis?.affected_industries?.length > 0) score += 2;\n    return Math.min(score, 10);\n  };\n  \n  console.log('处理的标题:', newsTitle);\n  console.log('处理的URL:', newsUrl);\n  \n  return {\n    json: {\n      // 必填字段\n      content_hash: generateContentHash(newsTitle),\n      title: newsTitle,\n      \n      // 其他字段\n      url: newsUrl || null,\n      author: newsAuthor,\n      news_time: pubDate ? new Date(pubDate).toISOString() : null,\n      generation_time: new Date().toISOString(),\n      domain: extractDomain(newsUrl),\n      analysis_quality_score: calculateQualityScore(analysis),\n      \n      // JSONB字段\n      processing_metadata: {\n        workflow_id: 'news_analysis_v3',\n        processing_time: new Date().toISOString(),\n        original_title: newsTitle,\n        data_source: 'bloomberg_rss'\n      },\n      full_analysis: analysis,\n      \n      // 状态字段\n      publication_status: 'completed',\n      publication_time: new Date().toISOString(),\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      \n      // 生成详细的HTML邮件内容\n      emailSubject: `AI股票分析报告 - ${newsTitle}`,\n      emailContent: generateDetailedEmailContent(analysis, newsTitle, newsUrl, newsAuthor, pubDate)\n    }\n  };\n});\n\nreturn processedItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        448,
        0
      ],
      "id": "5cd23d2c-9188-4287-8f60-09de37b3b10a",
      "name": "PostgreSQL数据映射"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list"
        },
        "table": {
          "__rl": true,
          "value": "processed_news",
          "mode": "list"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "content_hash": "={{ $json.content_hash }}",
            "title": "={{ $json.title }}",
            "url": "={{ $json.url }}",
            "author": "={{ $json.author }}",
            "news_time": "={{ $json.news_time }}",
            "generation_time": "={{ $json.generation_time }}",
            "domain": "={{ $json.domain }}",
            "analysis_quality_score": "={{ $json.analysis_quality_score }}",
            "processing_metadata": "={{ $json.processing_metadata }}",
            "full_analysis": "={{ $json.full_analysis }}",
            "publication_status": "={{ $json.publication_status }}",
            "publication_time": "={{ $json.publication_time }}",
            "created_at": "={{ $json.created_at }}",
            "updated_at": "={{ $json.updated_at }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "content_hash",
              "displayName": "content_hash",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "title",
              "displayName": "title",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "author",
              "displayName": "author",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "news_time",
              "displayName": "news_time",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "generation_time",
              "displayName": "generation_time",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "domain",
              "displayName": "domain",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "analysis_quality_score",
              "displayName": "analysis_quality_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "processing_metadata",
              "displayName": "processing_metadata",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            },
            {
              "id": "full_analysis",
              "displayName": "full_analysis",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            },
            {
              "id": "github_url",
              "displayName": "github_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "github_commit_sha",
              "displayName": "github_commit_sha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "publication_status",
              "displayName": "publication_status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "publication_time",
              "displayName": "publication_time",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        672,
        96
      ],
      "id": "a90e1c8e-ebde-45d7-87ec-c4542c52e1e4",
      "name": "保存到PostgreSQL",
      "credentials": {
        "postgres": {
          "id": "MDw95kKAOhEocU1a",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "wooyoo@gmail.com",
        "subject": "={{ $json.emailSubject }}",
        "message": "={{ $json.emailContent }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        672,
        -96
      ],
      "id": "6c7b60db-8f06-405c-8eeb-c49d4a8d1165",
      "name": "Send a message",
      "webhookId": "2100e9b4-6af3-4dac-8d9d-43f4559d6c2c",
      "credentials": {
        "gmailOAuth2": {
          "id": "4JbX2lbrKNuXw2VJ",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://www.stats.gov.cn/sj/zxfb/rss.xml",
        "options": {}
      },
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1.2,
      "position": [
        -800,
        336
      ],
      "id": "66161415-eb7f-4828-8435-bbcfbc91c16a",
      "name": "RSS Read1"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "RSS Read",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RSS Read": {
      "main": [
        [
          {
            "node": "RSS数据预处理",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RSS数据预处理": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Agent输出处理",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent输出处理": {
      "main": [
        [
          {
            "node": "PostgreSQL数据映射",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PostgreSQL数据映射": {
      "main": [
        [
          {
            "node": "保存到PostgreSQL",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "RSS Read1": {
      "main": [
        []
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "3c32dc6b-6d7b-4154-b5a4-39cffbea1a4e",
  "meta": {
    "instanceId": "10e0bafc59087611d6c482914c57b4ec59f75077e020a64fa5f8336fb3fa7b51"
  },
  "id": "ukjS3mKSjbgO9HsC",
  "tags": []
}